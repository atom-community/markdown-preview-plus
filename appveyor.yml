version: "{build}"
os: Windows Server 2012 R2
environment:
  matrix:
    #- GYP_MSVS_VERSION: 2008
    #   os: Windows Server 2012 R2
    #- GYP_MSVS_VERSION: 2010
    #   os: Windows Server 2012 R2
    - GYP_MSVS_VERSION: 2012
    #   os: Windows Server 2012 R2
    - GYP_MSVS_VERSION: 2013
build: off
deploy: off

cache:
  - C:\Users\appveyor\.atom\packages\mathjax-wrapper -> package.json

install:
  - cd %LOCALAPPDATA%
  - (New-Object Net.WebClient).DownloadFile("https://github.com/atom/atom/releases/download/$((Invoke-RestMethod -Method Get -Uri 'http://latest-atom-version.xyz/').trim())/atom-windows.zip", "$(pwd)\atom-windows.zip")
  - 7z -y x atom-windows.zip > nul
  - SET PATH=%LOCALAPPDATA%\Atom\resources\app\apm\bin;%PATH%
  - apm --version
  - ps: |
      If (Test-Path %USERPROFILE%\.atom\packages\mathjax-wrapper){
        Write-Host "Atom mathjax-wrapper already installed"
      }Else{
        apm install mathjax-wrapper
      }

test_script:
  - cd %APPVEYOR_BUILD_FOLDER%
  - apm clean
  - apm install
  - apm test --one --path %LOCALAPPDATA%\Atom\resources\cli\atom.cmd
