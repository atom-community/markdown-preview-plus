{"version":3,"sources":["util.ts","mathjax-helper.ts","update-preview.ts","..\\src\\util-common.ts","main.ts"],"names":["Object","defineProperty","exports","value","getMedia","document","querySelectorAll"],"mappings":"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,MAAvB,CFaM,CEbyB,GHA/B,CCaW,MEbqB,IAAD,EAAO,EAAP,EAAkE,AFa3F,KAA0B,SAA1B,GAAsC,UAAtC,GAAmD,KAAK,gBADpD;ADJV,ACMI,QEdoC,WAAA,EFc/B,CEd+B,eFcpC,GAAwB,UAAxB;ADLJ,QGTkD,aAAA,GAAA,mBFgBnC,GAAC;ADNhB,ACOM,QEjBwD,gBAAA,AFiBlD,GEjBkD,IFiB3C,EAAE,iBAAf;ADNN,ACOM,QElBuE,gBFkBnE,CAAC,IElBkE,AFkBnE,GElBmE,CFkB1D,KAAK,QAAL,KAAkB,QAA/B;AEjBJ,AHWF,ACOM,WElBG,QAAP,CAAgB,EFkBV,EElBN,CAAqB,OAArB,AFkBI,CElByB,EFkBV,MElBnB,IFkB4B,MAAT,EAAqB;AEjBxC,AHWF,ACOQ,WElBC,QAAP,CAAgB,QFkBN,EElBV,CAA2B,OAA3B,CAAmC,QFkBN,EElB7B,QFkBM,EAAmC,OAAO,KAAP;AEjBzC,AHWF,ACOQ,WElBC,QAAP,CAAgB,QFkBN,KElBV,CAA8B,CFkBb,MElBjB,CAAsC,CFkB5B,KAAoB,MAAxB,CElBN,CFkBsC,OAAO,KAAP;AEjBtC,AHWF,ACOQ,SDPR,EGXS,QAAP,CAAgB,MHWlB,CAAwC,CCO1B,KAAK,CDPnB,EAAwD,EGXtD,CAAmC,AFkB7B,OElBN,CAA2C,kBAA3C;AACD,AFkBO,CEvBR,2BFuBY,CAAC,GAAG,SAAH,CAAa,QAAb,CAAsB,MAAtB,CAAL,EAAoC,OAAO,KAAP;AEhB5C,AFiBQ,WEjBR,WAAA,CAAY,EAAZ,CAAiC,EFiBnB,MAAM,GAAG,KEjBvB,EAAmD,MFiB/B,CAAiB,GEjBe,IAAD,CFiB/B,CEjBsC,AFiBlD,EEjB2C,EAAc;AFkBzD,QElBoD,MAAA,GAAA,WFkBhD,CAAC,GAAL,EAAU,OAAO,KAAP;AEjBhB,AHQM,ACUA,QElBA,OAAO,KHQC,IGRQ,KHQC,ECUV,KAAK,CElBL,CAAuB,KHQtB,CAAwB,CCUzB,KAAmB,IAAI,IElBvB,CAAb,IFkBM,CDVQ,CAAR;AGPN,AHQM,ACUD,QElBD,CAAC,IAAL,EAAW,MAAM,AFUb,GDFc,CGRG,KAAJ,CAA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","file":"main.0a6e71c8.map","sourceRoot":"..\\src-client","sourcesContent":["export function handlePromise(promise: Promise<any>): void {\r\n  if (!promise) return\r\n  promise.catch((error: Error) => {\r\n    console.error(error)\r\n  })\r\n}\r\nimport { lstatSync, existsSync } from 'fs'\r\nexport function isFileSync(filePath: string) {\r\n  if (!existsSync(filePath)) return false\r\n  return lstatSync(filePath).isFile()\r\n}\r\n\r\nexport function resolveElement(\r\n  root: Element,\r\n  pathToToken: Array<{ tag: string; index: number }>,\r\n): Element | undefined {\r\n  let element = root\r\n  for (const token of pathToToken) {\r\n    const candidateElement: HTMLElement | null = element\r\n      .querySelectorAll(`:scope > ${token.tag}`)\r\n      .item(token.index) as HTMLElement\r\n    if (candidateElement) {\r\n      element = candidateElement\r\n    } else {\r\n      break\r\n    }\r\n  }\r\n\r\n  if (element === root) return undefined // Do not jump to the top of the preview for bad syncs\r\n  return element\r\n}\r\n","//\r\n// mathjax-helper\r\n//\r\n// This module will handle loading the MathJax environment and provide a wrapper\r\n// for calls to MathJax to process LaTeX equations.\r\n//\r\n\r\nimport path = require('path')\r\nimport CSON = require('season')\r\nimport fs = require('fs')\r\nimport { isFileSync } from './util'\r\n\r\nconst mjSrc = `${global.require.resolve(\r\n  'mathjax',\r\n)}?delayStartupUntil=configured`\r\nconst defaultRenderer: MathJaxRenderer = 'HTML-CSS'\r\n\r\n//\r\n// Process DOM elements for LaTeX equations with MathJax\r\n//\r\n// @param domElements An array of DOM elements to be processed by MathJax. See\r\n//   [element](https://developer.mozilla.org/en-US/docs/Web/API/element) for\r\n//   details on DOM elements.\r\n//\r\nexport async function mathProcessor(\r\n  domElement: Node,\r\n  renderer: MathJaxRenderer,\r\n) {\r\n  await loadMathJax()\r\n  await queueTypeset(domElement, renderer)\r\n}\r\n\r\n//\r\n// Process maths in HTML fragment with MathJax\r\n//\r\n// @param html A HTML fragment string\r\n// @param callback A callback method that accepts a single parameter, a HTML\r\n//   fragment string that is the result of html processed by MathJax\r\n//\r\nexport async function processHTMLString(element: Element) {\r\n  const msvgh = document.getElementById('MathJax_SVG_Hidden')\r\n  const svgGlyphs = msvgh && msvgh.parentElement\r\n  if (svgGlyphs !== null) {\r\n    return svgGlyphs.innerHTML + element.innerHTML\r\n  } else {\r\n    return element.innerHTML\r\n  }\r\n}\r\n\r\n//\r\n// Load MathJax environment\r\n//\r\n// @param listener method to call when the MathJax script was been\r\n//   loaded to the window. The method is passed no arguments.\r\n//\r\nlet mjPromise: Promise<void> | undefined\r\nasync function loadMathJax(): Promise<void> {\r\n  if (mjPromise) return mjPromise\r\n  mjPromise = attachMathJax()\r\n  return mjPromise\r\n}\r\n\r\n// for testing\r\nexport function unloadMathJax(): void {\r\n  mjPromise = undefined\r\n  const script = document.head.querySelector(`script[src='${mjSrc}']`)\r\n  if (script) script.remove()\r\n}\r\n\r\nexport async function jaxTeXConfig() {\r\n  let userMacros = await loadUserMacros()\r\n  if (userMacros) {\r\n    userMacros = checkMacros(userMacros)\r\n  } else {\r\n    userMacros = {}\r\n  }\r\n  const numberEqns = await window.atomVars.numberEqns\r\n\r\n  return {\r\n    extensions: await window.atomVars.mjxExtensions,\r\n    Macros: userMacros,\r\n    equationNumbers: numberEqns\r\n      ? {\r\n          autoNumber: 'AMS',\r\n          useLabelIds: false,\r\n        }\r\n      : {},\r\n  }\r\n}\r\n\r\n// private\r\n\r\nasync function getUserMacrosPath(): Promise<string> {\r\n  const home = await window.atomVars.home\r\n  const userMacrosPath: string | undefined | null = CSON.resolve(\r\n    path.join(home, 'markdown-preview-plus'),\r\n  )\r\n  return userMacrosPath != null\r\n    ? userMacrosPath\r\n    : path.join(home, 'markdown-preview-plus.cson')\r\n}\r\n\r\nfunction loadMacrosFile(filePath: string): object {\r\n  if (!CSON.isObjectPath(filePath)) {\r\n    return {}\r\n  }\r\n  return CSON.readFileSync(filePath, function(error?: Error, object?: object) {\r\n    if (object === undefined) {\r\n      object = {}\r\n    }\r\n    if (error !== undefined) {\r\n      console.warn(\r\n        `Error reading Latex Macros file '${filePath}': ${\r\n          error.stack !== undefined ? error.stack : error\r\n        }`,\r\n      )\r\n      console.error(`Failed to load Latex Macros from '${filePath}'`, {\r\n        detail: error.message,\r\n        dismissable: true,\r\n      })\r\n    }\r\n    return object\r\n  })\r\n}\r\n\r\nasync function loadUserMacros() {\r\n  const userMacrosPath = await getUserMacrosPath()\r\n  if (isFileSync(userMacrosPath)) {\r\n    return loadMacrosFile(userMacrosPath)\r\n  } else {\r\n    console.debug(\r\n      'Creating markdown-preview-plus.cson, this is a one-time operation.',\r\n    )\r\n    createMacrosTemplate(userMacrosPath)\r\n    return loadMacrosFile(userMacrosPath)\r\n  }\r\n}\r\n\r\nfunction createMacrosTemplate(filePath: string) {\r\n  const templatePath = path.join(__dirname, '../assets/macros-template.cson')\r\n  const templateFile = fs.readFileSync(templatePath, 'utf8')\r\n  fs.writeFileSync(filePath, templateFile)\r\n}\r\n\r\nfunction checkMacros(macrosObject: object) {\r\n  const namePattern = /^[^a-zA-Z\\d\\s]$|^[a-zA-Z]*$/ // letters, but no numerals.\r\n  for (const name in macrosObject) {\r\n    const value = macrosObject[name]\r\n    if (!name.match(namePattern) || !valueMatchesPattern(value)) {\r\n      delete macrosObject[name]\r\n      console.error(\r\n        `Failed to load LaTeX macro named '${name}'. Please see the [LaTeX guide](https://github.com/atom-community/markdown-preview-plus/blob/master/docs/math.md#macro-names)`,\r\n      )\r\n    }\r\n  }\r\n  return macrosObject\r\n}\r\n\r\nfunction valueMatchesPattern(value: any) {\r\n  // Different check based on whether value is string or array\r\n  if (Array.isArray(value)) {\r\n    const macroDefinition = value[0]\r\n    const numberOfArgs = value[1]\r\n    if (typeof numberOfArgs === 'number') {\r\n      return numberOfArgs % 1 === 0 && typeof macroDefinition === 'string'\r\n    } else {\r\n      return false\r\n    }\r\n  } else if (typeof value === 'string') {\r\n    return true\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n\r\n// Configure MathJax environment. Similar to the TeX-AMS_HTML configuration with\r\n// a few unnecessary features stripped away\r\n//\r\nasync function configureMathJax() {\r\n  MathJax.Hub.Config({\r\n    jax: ['input/TeX', `output/${defaultRenderer}`],\r\n    extensions: [],\r\n    TeX: await jaxTeXConfig(),\r\n    'HTML-CSS': {\r\n      availableFonts: [],\r\n      webFont: 'TeX',\r\n      imageFont: null as any, // TODO: complain on DT\r\n      mtextFontInherit: true,\r\n      undefinedFamily: await window.atomVars.mjxUndefinedFamily,\r\n    },\r\n    messageStyle: 'none',\r\n    showMathMenu: false,\r\n    skipStartupTypeset: true,\r\n  })\r\n  MathJax.Hub.Configured()\r\n\r\n  // Notify user MathJax has loaded\r\n  console.log('Loaded maths rendering engine MathJax')\r\n}\r\n\r\n//\r\n// Attach main MathJax script to the document\r\n//\r\nasync function attachMathJax(): Promise<void> {\r\n  console.log('Loading maths rendering engine MathJax')\r\n\r\n  // Attach MathJax script\r\n  await Promise.all([injectScript(mjSrc)])\r\n  await configureMathJax()\r\n}\r\n\r\nasync function injectScript(scriptSrc: string) {\r\n  const script = document.createElement('script')\r\n  script.src = scriptSrc\r\n  script.type = 'text/javascript'\r\n  document.head.appendChild(script)\r\n  return new Promise<void>((resolve) => {\r\n    script.addEventListener('load', () => resolve())\r\n  })\r\n}\r\n\r\nasync function queueTypeset(domElement: Node, renderer: MathJaxRenderer) {\r\n  const hasUnprocessedMath = Array.from(\r\n    document.querySelectorAll('script[type^=\"math/tex\"]'),\r\n  ).some((x) => !x.id)\r\n  if (!hasUnprocessedMath) return\r\n  const numberEqns = await window.atomVars.numberEqns\r\n  return new Promise<void>((resolve) => {\r\n    if (MathJax.InputJax.TeX) {\r\n      MathJax.Hub.Queue(['resetEquationNumbers', MathJax.InputJax.TeX])\r\n      if (numberEqns) {\r\n        MathJax.Hub.Queue(['PreProcess', MathJax.Hub])\r\n        MathJax.Hub.Queue(['Reprocess', MathJax.Hub])\r\n      }\r\n    }\r\n\r\n    MathJax.Hub.Queue(['setRenderer', MathJax.Hub, renderer])\r\n    MathJax.Hub.Queue(['Typeset', MathJax.Hub, domElement])\r\n    MathJax.Hub.Queue(['setRenderer', MathJax.Hub, defaultRenderer])\r\n    MathJax.Hub.Queue([resolve])\r\n  })\r\n}\r\n","// This file incorporates code from [markmon](https://github.com/yyjhao/markmon)\r\n// covered by the following terms:\r\n//\r\n// Copyright (c) 2014, Yao Yujian, http://yjyao.com\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a copy\r\n// of this software and associated documentation files (the \"Software\"), to deal\r\n// in the Software without restriction, including without limitation the rights\r\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n// copies of the Software, and to permit persons to whom the Software is\r\n// furnished to do so, subject to the following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included in\r\n// all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n// THE SOFTWARE.\r\nimport morph = require('morphdom')\r\nimport MathJaxHelper = require('./mathjax-helper')\r\n\r\nexport class UpdatePreview {\r\n  private cachedMJRenderer?: MathJaxRenderer\r\n  constructor(private dom: HTMLElement) {\r\n    /* no-op */\r\n  }\r\n\r\n  public async update(\r\n    newDom: Element,\r\n    renderLaTeX: boolean,\r\n    mjrenderer: MathJaxRenderer,\r\n  ): Promise<void> {\r\n    const lastMJRenderer =\r\n      this.cachedMJRenderer === undefined ? mjrenderer : this.cachedMJRenderer\r\n    this.cachedMJRenderer = mjrenderer\r\n\r\n    for (const m of Array.from(newDom.querySelectorAll('span.math'))) {\r\n      const mscr = m.firstElementChild as HTMLScriptElement | null\r\n      if (!mscr || mscr.nodeName !== 'SCRIPT') continue\r\n      m.isSameNode = function(target: Node) {\r\n        if (lastMJRenderer !== mjrenderer) return false\r\n        if (target.nodeName !== 'SPAN') return false\r\n        const el = target as HTMLSpanElement\r\n        if (!el.classList.contains('math')) return false\r\n        const scr = el.querySelector('script')\r\n        if (!scr) return false\r\n        return mscr.innerHTML === scr.innerHTML\r\n      }\r\n    }\r\n\r\n    morph(this.dom, newDom, {\r\n      childrenOnly: true,\r\n      onElUpdated: function(el) {\r\n        if (el.tagName === 'LI') el.innerHTML = el.innerHTML // force re-render\r\n      },\r\n    })\r\n\r\n    if (renderLaTeX) {\r\n      return MathJaxHelper.mathProcessor(this.dom, mjrenderer)\r\n    }\r\n  }\r\n}\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction getMedia(document) {\r\n    return document.querySelectorAll('img[src],audio[src],video[src]');\r\n}\r\nexports.getMedia = getMedia;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC1jb21tb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC1jb21tb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxrQkFBeUIsUUFBc0I7SUFDN0MsT0FBTyxRQUFRLENBQUMsZ0JBQWdCLENBQzlCLGdDQUFnQyxDQUNxQyxDQUFBO0FBQ3pFLENBQUM7QUFKRCw0QkFJQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBnZXRNZWRpYShkb2N1bWVudDogSFRNTERvY3VtZW50KSB7XHJcbiAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXHJcbiAgICAnaW1nW3NyY10sYXVkaW9bc3JjXSx2aWRlb1tzcmNdJyxcclxuICApIGFzIE5vZGVMaXN0T2Y8SFRNTEltYWdlRWxlbWVudCB8IEhUTUxBdWRpb0VsZW1lbnQgfCBIVE1MVmlkZW9FbGVtZW50PlxyXG59XHJcbiJdfQ==","import { ipcRenderer } from 'electron'\r\nimport { UpdatePreview } from './update-preview'\r\nimport { processHTMLString, jaxTeXConfig } from './mathjax-helper'\r\nimport * as util from './util'\r\nimport { getMedia } from '../src/util-common'\r\n\r\nfunction mkResPromise<T>(): ResolvablePromise<T> {\r\n  let resFn: (value?: T | PromiseLike<T> | undefined) => void\r\n  const p = new Promise<T>((resolve) => (resFn = resolve)) as ResolvablePromise<\r\n    T\r\n  >\r\n  p.resolve = resFn!\r\n  return p\r\n}\r\n\r\nwindow.atomVars = {\r\n  home: mkResPromise(),\r\n  numberEqns: mkResPromise(),\r\n  mjxExtensions: mkResPromise(),\r\n  mjxUndefinedFamily: mkResPromise(),\r\n  sourceLineMap: new Map(),\r\n  revSourceMap: new WeakMap(),\r\n}\r\n\r\nipcRenderer.on<'init'>('init', (_evt, { atomHome, numberEqns, mjxExtensions, mjxUndefinedFamily }) => {\r\n  window.atomVars.home.resolve(atomHome)\r\n  window.atomVars.numberEqns.resolve(numberEqns)\r\n  window.atomVars.mjxExtensions.resolve(mjxExtensions)\r\n  window.atomVars.mjxUndefinedFamily.resolve(mjxUndefinedFamily)\r\n})\r\n\r\nipcRenderer.on<'set-source-map'>('set-source-map', (_evt, { map }) => {\r\n  const root = document.querySelector('div.update-preview')\r\n  if (!root) throw new Error('No root element!')\r\n  const slsm = new Map<number, Element>()\r\n  const rsm = new WeakMap<Element, number[]>()\r\n  for (const lineS of Object.keys(map)) {\r\n    const line = parseInt(lineS, 10)\r\n    const path = map[line]\r\n    const elem = util.resolveElement(root, path)\r\n    if (elem) {\r\n      slsm.set(line, elem)\r\n      const rsmel = rsm.get(elem)\r\n      if (rsmel) rsmel.push(line)\r\n      else rsm.set(elem, [line])\r\n    }\r\n  }\r\n  window.atomVars.sourceLineMap = slsm\r\n  window.atomVars.revSourceMap = rsm\r\n})\r\n\r\nipcRenderer.on<'scroll-sync'>(\r\n  'scroll-sync',\r\n  (_evt, { firstLine, lastLine }) => {\r\n    const mean = Math.floor(0.5 * (firstLine + lastLine))\r\n    const slm = window.atomVars.sourceLineMap\r\n    let topLine\r\n    let topBound\r\n    for (topLine = mean; topLine >= 0; topLine -= 1) {\r\n      topBound = slm.get(topLine)\r\n      if (topBound) break\r\n    }\r\n    if (!topBound) return\r\n\r\n    const max = Math.max(...Array.from(slm.keys()))\r\n    let bottomLine\r\n    let bottomBound\r\n    for (bottomLine = mean + 1; bottomLine < max; bottomLine += 1) {\r\n      bottomBound = slm.get(bottomLine)\r\n      if (bottomBound) break\r\n    }\r\n    if (!bottomBound) return\r\n    const topScroll = topBound.getBoundingClientRect().top\r\n    const bottomScroll = bottomBound.getBoundingClientRect().top\r\n    const frac = (mean - firstLine) / (lastLine - firstLine)\r\n    const offset = document.documentElement.scrollTop\r\n    const clientHeight = document.documentElement.clientHeight\r\n    const top =\r\n      offset - clientHeight / 2 + topScroll + frac * (bottomScroll - topScroll)\r\n    window.scroll({ top })\r\n  },\r\n)\r\n\r\nipcRenderer.on<'style'>('style', (_event, { styles }) => {\r\n  let styleElem = document.head.querySelector('style#atom-styles')\r\n  if (!styleElem) {\r\n    styleElem = document.createElement('style')\r\n    styleElem.id = 'atom-styles'\r\n    document.head.appendChild(styleElem)\r\n  }\r\n  styleElem.innerHTML = styles.join('\\n')\r\n})\r\n\r\nipcRenderer.on<'update-images'>('update-images', (_event, { oldsrc, v }) => {\r\n  const imgs = getMedia(document)\r\n  for (const img of Array.from(imgs)) {\r\n    let ovs: string | undefined\r\n    let ov: number | undefined\r\n    let src = img.getAttribute('src')!\r\n    const match = src.match(/^(.*)\\?v=(\\d+)$/)\r\n    if (match) [, src, ovs] = match\r\n    if (src === oldsrc) {\r\n      if (ovs !== undefined) ov = parseInt(ovs, 10)\r\n      if (v !== ov) img.src = v ? `${src}?v=${v}` : `${src}`\r\n    }\r\n  }\r\n})\r\n\r\nipcRenderer.on<'sync'>('sync', (_event, { line }) => {\r\n  const root = document.querySelector('div.update-preview')\r\n  if (!root) return\r\n\r\n  let element = window.atomVars.sourceLineMap.get(line)\r\n\r\n  if (!element) {\r\n    for (let i = line - 1; i >= 0; i -= 1) {\r\n      element = window.atomVars.sourceLineMap.get(line)\r\n      if (element) break\r\n    }\r\n  }\r\n\r\n  if (!element) return\r\n\r\n  element.scrollIntoViewIfNeeded(true)\r\n\r\n  element.classList.add('flash')\r\n  setTimeout(() => element!.classList.remove('flash'), 1000)\r\n})\r\n\r\nipcRenderer.on<'use-github-style'>('use-github-style', (_event, { value }) => {\r\n  const elem = document.querySelector('markdown-preview-plus-view')\r\n  if (!elem) throw new Error(`Can't find MPP-view`)\r\n  if (value) {\r\n    elem.setAttribute('data-use-github-style', '')\r\n  } else {\r\n    elem.removeAttribute('data-use-github-style')\r\n  }\r\n})\r\n\r\nlet updatePreview: UpdatePreview | undefined\r\n\r\nipcRenderer.on<'update-preview'>(\r\n  'update-preview',\r\n  (_event, { id, html, renderLaTeX, mjrenderer }) => {\r\n    // div.update-preview created after constructor st UpdatePreview cannot\r\n    // be instanced in the constructor\r\n    const preview = document.querySelector('div.update-preview')\r\n    if (!preview) return\r\n    if (!updatePreview) {\r\n      updatePreview = new UpdatePreview(preview as HTMLElement)\r\n    }\r\n    const parser = new DOMParser()\r\n    const domDocument = parser.parseFromString(html, 'text/html')\r\n    util.handlePromise(\r\n      updatePreview\r\n        .update(domDocument.body, renderLaTeX, mjrenderer)\r\n        .then(async () => {\r\n          ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n            id,\r\n            request: 'update-preview',\r\n            result: await processHTMLString(preview),\r\n          })\r\n        }),\r\n    )\r\n    const doc = document\r\n    if (doc && domDocument.head.hasChildNodes) {\r\n      let container = doc.head.querySelector('original-elements')\r\n      if (!container) {\r\n        container = doc.createElement('original-elements')\r\n        doc.head.appendChild(container)\r\n      }\r\n      container.innerHTML = ''\r\n      for (const headElement of Array.from(domDocument.head.childNodes)) {\r\n        container.appendChild(headElement)\r\n      }\r\n    }\r\n  },\r\n)\r\n\r\nconst baseElement = document.createElement('base')\r\ndocument.head.appendChild(baseElement)\r\n\r\nipcRenderer.on<'set-base-path'>('set-base-path', (_evt, { path }) => {\r\n  if (path) baseElement.href = path\r\n  else baseElement.href = ''\r\n})\r\n\r\nipcRenderer.on<'error'>('error', (_evt, { msg }) => {\r\n  const preview = document.querySelector('div.update-preview')\r\n  if (!preview) return\r\n  const errorDiv = document.createElement('div')\r\n  errorDiv.innerHTML = `<h2>Previewing Markdown Failed</h2><h3>${msg}</h3>`\r\n  preview.appendChild(errorDiv)\r\n})\r\n\r\ndocument.addEventListener('mousewheel', (event) => {\r\n  if (event.ctrlKey) {\r\n    if (event.wheelDeltaY > 0) {\r\n      ipcRenderer.sendToHost<'zoom-in'>('zoom-in', undefined)\r\n    } else if (event.wheelDeltaY < 0) {\r\n      ipcRenderer.sendToHost<'zoom-out'>('zoom-out', undefined)\r\n    }\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n  }\r\n})\r\n\r\ndocument.addEventListener('scroll', (_event) => {\r\n  const el = document.documentElement\r\n  const height = el.clientHeight\r\n  const visible = Array.from(window.atomVars.sourceLineMap.entries())\r\n    .filter(([_line, elem]) => {\r\n      const { top, bottom } = elem.getBoundingClientRect()\r\n      return top > 0 && bottom < height\r\n    })\r\n    .map(([line, _elem]) => line)\r\n  ipcRenderer.sendToHost<'did-scroll-preview'>('did-scroll-preview', {\r\n    max: Math.max(...visible),\r\n    min: Math.min(...visible),\r\n  })\r\n})\r\n\r\nlet lastContextMenuTarget: HTMLElement\r\ndocument.addEventListener('contextmenu', (e) => {\r\n  lastContextMenuTarget = e.target as HTMLElement\r\n})\r\n\r\nipcRenderer.on<'sync-source'>('sync-source', (_, { id }) => {\r\n  let element = lastContextMenuTarget\r\n  const rsm = window.atomVars.revSourceMap\r\n  let lines = rsm.get(element)\r\n\r\n  while (!lines && element.parentElement) {\r\n    element = element.parentElement\r\n    lines = rsm.get(element)\r\n  }\r\n  if (!lines) return\r\n\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'sync-source',\r\n    result: Math.min(...lines),\r\n  })\r\n})\r\n\r\nipcRenderer.on<'reload'>('reload', (_, { id }) => {\r\n  window.onbeforeunload = null\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'reload',\r\n    result: undefined,\r\n  })\r\n})\r\n\r\nwindow.onbeforeunload = function() {\r\n  return false\r\n}\r\n\r\nipcRenderer.on<'get-tex-config'>('get-tex-config', async (_, { id }) => {\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'get-tex-config',\r\n    result: await jaxTeXConfig(),\r\n  })\r\n})\r\n"]}