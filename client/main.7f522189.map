{"version":3,"sources":["util.ts","mathjax-helper.ts","update-preview.ts","0","main.ts"],"names":["getMedia","document","querySelectorAll","Object","defineProperty","exports","value"],"mappings":"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","file":"main.7f522189.map","sourceRoot":"..\\src-client","sourcesContent":["export function handlePromise(promise: Promise<any>): void {\r\n  if (!promise) return\r\n  promise.catch((error: Error) => {\r\n    console.error(error)\r\n  })\r\n}\r\nimport { lstatSync, existsSync } from 'fs'\r\nexport function isFileSync(filePath: string) {\r\n  if (!existsSync(filePath)) return false\r\n  return lstatSync(filePath).isFile()\r\n}\r\n\r\nexport function resolveElement(\r\n  root: Element,\r\n  pathToToken: Array<{ tag: string; index: number }>,\r\n): Element | undefined {\r\n  let element = root\r\n  for (const token of pathToToken) {\r\n    const candidateElement: HTMLElement | null = element\r\n      .querySelectorAll(`:scope > ${token.tag}`)\r\n      .item(token.index) as HTMLElement\r\n    if (candidateElement) {\r\n      element = candidateElement\r\n    } else {\r\n      break\r\n    }\r\n  }\r\n\r\n  if (element === root) return undefined // Do not jump to the top of the preview for bad syncs\r\n  return element\r\n}\r\n","//\r\n// mathjax-helper\r\n//\r\n// This module will handle loading the MathJax environment and provide a wrapper\r\n// for calls to MathJax to process LaTeX equations.\r\n//\r\n\r\nimport path = require('path')\r\nimport CSON = require('season')\r\nimport fs = require('fs')\r\nimport { isFileSync } from './util'\r\n\r\nconst mjSrc = `${global.require.resolve(\r\n  'mathjax',\r\n)}?delayStartupUntil=configured`\r\n\r\n//\r\n// Process DOM elements for LaTeX equations with MathJax\r\n//\r\n// @param domElements An array of DOM elements to be processed by MathJax. See\r\n//   [element](https://developer.mozilla.org/en-US/docs/Web/API/element) for\r\n//   details on DOM elements.\r\n//\r\nexport async function mathProcessor(domElement: Node) {\r\n  await loadMathJax()\r\n  await queueTypeset(domElement)\r\n}\r\n\r\n//\r\n// Process maths in HTML fragment with MathJax\r\n//\r\n// @param html A HTML fragment string\r\n// @param callback A callback method that accepts a single parameter, a HTML\r\n//   fragment string that is the result of html processed by MathJax\r\n//\r\nexport async function processHTMLString(element: Element) {\r\n  const msvgh = document.getElementById('MathJax_SVG_Hidden')\r\n  const svgGlyphs = msvgh && msvgh.parentElement\r\n  if (svgGlyphs !== null) {\r\n    return svgGlyphs.innerHTML + element.innerHTML\r\n  } else {\r\n    return element.innerHTML\r\n  }\r\n}\r\n\r\nexport async function rerenderMath() {\r\n  if (mjPromise !== undefined) {\r\n    await mjPromise\r\n    return new Promise<void>((resolve) => {\r\n      MathJax.Hub.Queue(['Rerender', MathJax.Hub])\r\n      MathJax.Hub.Queue([resolve])\r\n    })\r\n  } else {\r\n    return\r\n  }\r\n}\r\n\r\n//\r\n// Load MathJax environment\r\nlet mjPromise: Promise<void> | undefined\r\nasync function loadMathJax(): Promise<void> {\r\n  if (mjPromise) return mjPromise\r\n  mjPromise = attachMathJax()\r\n  return mjPromise\r\n}\r\n\r\n// for testing\r\nexport function unloadMathJax(): void {\r\n  mjPromise = undefined\r\n  const script = document.head.querySelector(`script[src='${mjSrc}']`)\r\n  if (script) script.remove()\r\n}\r\n\r\nexport async function jaxTeXConfig() {\r\n  let userMacros = await loadUserMacros()\r\n  if (userMacros) {\r\n    userMacros = checkMacros(userMacros)\r\n  } else {\r\n    userMacros = {}\r\n  }\r\n  const mathJaxConfig: MathJaxConfig = await window.atomVars.mathJaxConfig\r\n\r\n  return {\r\n    extensions: mathJaxConfig.texExtensions,\r\n    Macros: userMacros,\r\n    equationNumbers: mathJaxConfig.numberEquations\r\n      ? {\r\n          autoNumber: 'AMS',\r\n          useLabelIds: false,\r\n        }\r\n      : {},\r\n  }\r\n}\r\n\r\n// private\r\n\r\nasync function getUserMacrosPath(): Promise<string> {\r\n  const home = await window.atomVars.home\r\n  const userMacrosPath: string | undefined | null = CSON.resolve(\r\n    path.join(home, 'markdown-preview-plus'),\r\n  )\r\n  return userMacrosPath != null\r\n    ? userMacrosPath\r\n    : path.join(home, 'markdown-preview-plus.cson')\r\n}\r\n\r\nfunction loadMacrosFile(filePath: string): object {\r\n  if (!CSON.isObjectPath(filePath)) {\r\n    return {}\r\n  }\r\n  return CSON.readFileSync(filePath, function(error?: Error, object?: object) {\r\n    if (object === undefined) {\r\n      object = {}\r\n    }\r\n    if (error !== undefined) {\r\n      console.warn(\r\n        `Error reading Latex Macros file '${filePath}': ${\r\n          error.stack !== undefined ? error.stack : error\r\n        }`,\r\n      )\r\n      console.error(`Failed to load Latex Macros from '${filePath}'`, {\r\n        detail: error.message,\r\n        dismissable: true,\r\n      })\r\n    }\r\n    return object\r\n  })\r\n}\r\n\r\nasync function loadUserMacros() {\r\n  const userMacrosPath = await getUserMacrosPath()\r\n  if (isFileSync(userMacrosPath)) {\r\n    return loadMacrosFile(userMacrosPath)\r\n  } else {\r\n    console.debug(\r\n      'Creating markdown-preview-plus.cson, this is a one-time operation.',\r\n    )\r\n    createMacrosTemplate(userMacrosPath)\r\n    return loadMacrosFile(userMacrosPath)\r\n  }\r\n}\r\n\r\nfunction createMacrosTemplate(filePath: string) {\r\n  const templatePath = path.join(__dirname, '../assets/macros-template.cson')\r\n  const templateFile = fs.readFileSync(templatePath, 'utf8')\r\n  fs.writeFileSync(filePath, templateFile)\r\n}\r\n\r\nfunction checkMacros(macrosObject: object) {\r\n  const namePattern = /^[^a-zA-Z\\d\\s]$|^[a-zA-Z]*$/ // letters, but no numerals.\r\n  for (const name in macrosObject) {\r\n    const value = macrosObject[name]\r\n    if (!name.match(namePattern) || !valueMatchesPattern(value)) {\r\n      delete macrosObject[name]\r\n      console.error(\r\n        `Failed to load LaTeX macro named '${name}'. Please see the [LaTeX guide](https://github.com/atom-community/markdown-preview-plus/blob/master/docs/math.md#macro-names)`,\r\n      )\r\n    }\r\n  }\r\n  return macrosObject\r\n}\r\n\r\nfunction valueMatchesPattern(value: any) {\r\n  // Different check based on whether value is string or array\r\n  if (Array.isArray(value)) {\r\n    const macroDefinition = value[0]\r\n    const numberOfArgs = value[1]\r\n    if (typeof numberOfArgs === 'number') {\r\n      return numberOfArgs % 1 === 0 && typeof macroDefinition === 'string'\r\n    } else {\r\n      return false\r\n    }\r\n  } else if (typeof value === 'string') {\r\n    return true\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n\r\n// Configure MathJax environment. Similar to the TeX-AMS_HTML configuration with\r\n// a few unnecessary features stripped away\r\n//\r\nasync function configureMathJax() {\r\n  const mathJaxConfig = await window.atomVars.mathJaxConfig\r\n  MathJax.Hub.Config({\r\n    jax: ['input/TeX', `output/${mathJaxConfig.renderer}`],\r\n    extensions: [],\r\n    TeX: await jaxTeXConfig(),\r\n    'HTML-CSS': {\r\n      availableFonts: [],\r\n      webFont: 'TeX',\r\n      imageFont: null as any, // TODO: complain on DT\r\n      undefinedFamily: mathJaxConfig.undefinedFamily as any, // TODO: complain on DT\r\n      mtextFontInherit: true,\r\n    },\r\n    messageStyle: 'none',\r\n    showMathMenu: false,\r\n    skipStartupTypeset: true,\r\n  })\r\n  MathJax.Hub.Configured()\r\n\r\n  // Notify user MathJax has loaded\r\n  console.log('Loaded maths rendering engine MathJax')\r\n}\r\n\r\n//\r\n// Attach main MathJax script to the document\r\n//\r\nasync function attachMathJax(): Promise<void> {\r\n  console.log('Loading maths rendering engine MathJax')\r\n\r\n  // Attach MathJax script\r\n  await Promise.all([injectScript(mjSrc)])\r\n  await configureMathJax()\r\n}\r\n\r\nasync function injectScript(scriptSrc: string) {\r\n  const script = document.createElement('script')\r\n  script.src = scriptSrc\r\n  script.type = 'text/javascript'\r\n  document.head.appendChild(script)\r\n  return new Promise<void>((resolve) => {\r\n    script.addEventListener('load', () => resolve())\r\n  })\r\n}\r\n\r\nasync function queueTypeset(domElement: Node) {\r\n  const hasUnprocessedMath = Array.from(\r\n    document.querySelectorAll('script[type^=\"math/tex\"]'),\r\n  ).some((x) => !x.id)\r\n  if (!hasUnprocessedMath) return\r\n  const mathJaxConfig: MathJaxConfig = await window.atomVars.mathJaxConfig\r\n  return new Promise<void>((resolve) => {\r\n    if (MathJax.InputJax.TeX) {\r\n      MathJax.Hub.Queue(['resetEquationNumbers', MathJax.InputJax.TeX])\r\n      if (mathJaxConfig.numberEquations) {\r\n        MathJax.Hub.Queue(['PreProcess', MathJax.Hub])\r\n        MathJax.Hub.Queue(['Reprocess', MathJax.Hub])\r\n      }\r\n    }\r\n\r\n    MathJax.Hub.Queue(['Typeset', MathJax.Hub, domElement])\r\n    MathJax.Hub.Queue([resolve])\r\n  })\r\n}\r\n","// This file incorporates code from [markmon](https://github.com/yyjhao/markmon)\r\n// covered by the following terms:\r\n//\r\n// Copyright (c) 2014, Yao Yujian, http://yjyao.com\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a copy\r\n// of this software and associated documentation files (the \"Software\"), to deal\r\n// in the Software without restriction, including without limitation the rights\r\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n// copies of the Software, and to permit persons to whom the Software is\r\n// furnished to do so, subject to the following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included in\r\n// all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n// THE SOFTWARE.\r\nimport morph = require('morphdom')\r\nimport MathJaxHelper = require('./mathjax-helper')\r\n\r\nexport class UpdatePreview {\r\n  constructor(private dom: HTMLElement) {\r\n    /* no-op */\r\n  }\r\n\r\n  public async update(newDom: Element, renderLaTeX: boolean): Promise<void> {\r\n    for (const m of Array.from(newDom.querySelectorAll('span.math'))) {\r\n      const mscr = m.firstElementChild as HTMLScriptElement | null\r\n      if (!mscr || mscr.nodeName !== 'SCRIPT') continue\r\n      m.isSameNode = function(target: Node) {\r\n        if (target.nodeName !== 'SPAN') return false\r\n        const el = target as HTMLSpanElement\r\n        if (!el.classList.contains('math')) return false\r\n        const scr = el.querySelector('script')\r\n        if (!scr) return false\r\n        return mscr.innerHTML === scr.innerHTML && mscr.type === scr.type\r\n      }\r\n    }\r\n\r\n    morph(this.dom, newDom, {\r\n      childrenOnly: true,\r\n    })\r\n\r\n    // A very specific fix for #386 and #406\r\n    for (const li of this.dom.querySelectorAll('li')) {\r\n      if (\r\n        li.firstElementChild &&\r\n        li.firstElementChild === li.lastElementChild &&\r\n        li.firstElementChild.tagName === 'P' &&\r\n        li.firstChild &&\r\n        li.firstChild.nodeType === Node.TEXT_NODE &&\r\n        li.firstChild.textContent === '\\n'\r\n      ) {\r\n        li.removeChild(li.firstChild)\r\n      }\r\n    }\r\n\r\n    if (renderLaTeX) {\r\n      return MathJaxHelper.mathProcessor(this.dom)\r\n    }\r\n  }\r\n}\r\n",null,"import { ipcRenderer } from 'electron'\r\nimport { UpdatePreview } from './update-preview'\r\nimport { processHTMLString, jaxTeXConfig, rerenderMath } from './mathjax-helper'\r\nimport * as util from './util'\r\nimport { getMedia } from '../src/util-common'\r\n\r\nwindow.addEventListener('error', (e) => {\r\n  const err = e.error as Error\r\n  ipcRenderer.sendToHost<'uncaught-error'>('uncaught-error', {\r\n    message: err.message,\r\n    name: err.name,\r\n    stack: err.stack,\r\n  })\r\n})\r\n\r\nwindow.addEventListener('unhandledrejection', (evt) => {\r\n  const err = (evt as any).reason as Error\r\n  ipcRenderer.sendToHost<'uncaught-error'>('uncaught-error', {\r\n    message: err.message,\r\n    name: err.name,\r\n    stack: err.stack,\r\n  })\r\n})\r\n\r\nfunction mkResPromise<T>(): ResolvablePromise<T> {\r\n  let resFn: (value?: T | PromiseLike<T> | undefined) => void\r\n  const p = new Promise<T>((resolve) => (resFn = resolve)) as ResolvablePromise<\r\n    T\r\n  >\r\n  p.resolve = resFn!\r\n  return p\r\n}\r\n\r\nwindow.atomVars = {\r\n  home: mkResPromise(),\r\n  mathJaxConfig: mkResPromise(),\r\n  sourceLineMap: new Map(),\r\n  revSourceMap: new WeakMap(),\r\n}\r\n\r\nipcRenderer.on<'init'>(\r\n  'init',\r\n  (_evt, { atomHome, mathJaxConfig, mathJaxRenderer }) => {\r\n    window.atomVars.home.resolve(atomHome)\r\n    window.atomVars.mathJaxConfig.resolve({\r\n      ...mathJaxConfig,\r\n      renderer: mathJaxRenderer,\r\n    })\r\n  },\r\n)\r\n\r\nipcRenderer.on<'set-source-map'>('set-source-map', (_evt, { map }) => {\r\n  const root = document.querySelector('div.update-preview')\r\n  if (!root) throw new Error('No root element!')\r\n  const slsm = new Map<number, Element>()\r\n  const rsm = new WeakMap<Element, number[]>()\r\n  for (const lineS of Object.keys(map)) {\r\n    const line = parseInt(lineS, 10)\r\n    const path = map[line]\r\n    const elem = util.resolveElement(root, path)\r\n    if (elem) {\r\n      slsm.set(line, elem)\r\n      const rsmel = rsm.get(elem)\r\n      if (rsmel) rsmel.push(line)\r\n      else rsm.set(elem, [line])\r\n    }\r\n  }\r\n  window.atomVars.sourceLineMap = slsm\r\n  window.atomVars.revSourceMap = rsm\r\n})\r\n\r\nipcRenderer.on<'scroll-sync'>(\r\n  'scroll-sync',\r\n  (_evt, { firstLine, lastLine }) => {\r\n    const mean = Math.floor(0.5 * (firstLine + lastLine))\r\n    const slm = window.atomVars.sourceLineMap\r\n    let topLine\r\n    let topBound\r\n    for (topLine = mean; topLine >= 0; topLine -= 1) {\r\n      topBound = slm.get(topLine)\r\n      if (topBound) break\r\n    }\r\n    if (!topBound) return\r\n\r\n    const max = Math.max(...Array.from(slm.keys()))\r\n    let bottomLine\r\n    let bottomBound\r\n    for (bottomLine = mean + 1; bottomLine < max; bottomLine += 1) {\r\n      bottomBound = slm.get(bottomLine)\r\n      if (bottomBound) break\r\n    }\r\n    if (!bottomBound) return\r\n    const topScroll = topBound.getBoundingClientRect().top\r\n    const bottomScroll = bottomBound.getBoundingClientRect().top\r\n    const frac = (mean - firstLine) / (lastLine - firstLine)\r\n    const offset = document.documentElement.scrollTop\r\n    const clientHeight = document.documentElement.clientHeight\r\n    const top =\r\n      offset - clientHeight / 2 + topScroll + frac * (bottomScroll - topScroll)\r\n    window.scroll({ top })\r\n  },\r\n)\r\n\r\nipcRenderer.on<'style'>('style', (_event, { styles }) => {\r\n  let styleElem = document.head.querySelector('style#atom-styles')\r\n  if (!styleElem) {\r\n    styleElem = document.createElement('style')\r\n    styleElem.id = 'atom-styles'\r\n    document.head.appendChild(styleElem)\r\n  }\r\n  styleElem.innerHTML = styles.join('\\n')\r\n})\r\n\r\nipcRenderer.on<'update-images'>('update-images', (_event, { oldsrc, v }) => {\r\n  const imgs = getMedia(document)\r\n  for (const img of Array.from(imgs)) {\r\n    let ovs: string | undefined\r\n    let ov: number | undefined\r\n    let attrName: 'href' | 'src'\r\n    if (img.tagName === 'LINK') attrName = 'href'\r\n    else attrName = 'src'\r\n    let src = img.getAttribute(attrName)!\r\n    const match = src.match(/^(.*)\\?v=(\\d+)$/)\r\n    if (match) [, src, ovs] = match\r\n    if (src === oldsrc) {\r\n      if (ovs !== undefined) ov = parseInt(ovs, 10)\r\n      if (v !== ov) img[attrName] = v ? `${src}?v=${v}` : `${src}`\r\n    }\r\n  }\r\n})\r\n\r\nipcRenderer.on<'sync'>('sync', (_event, { line, flash }) => {\r\n  const root = document.querySelector('div.update-preview')\r\n  if (!root) return\r\n\r\n  let element = window.atomVars.sourceLineMap.get(line)\r\n\r\n  if (!element) {\r\n    for (let i = line - 1; i >= 0; i -= 1) {\r\n      element = window.atomVars.sourceLineMap.get(line)\r\n      if (element) break\r\n    }\r\n  }\r\n\r\n  if (!element) return\r\n\r\n  element.scrollIntoViewIfNeeded(true)\r\n\r\n  if (flash) {\r\n    element.classList.add('flash')\r\n    setTimeout(() => element!.classList.remove('flash'), 1000)\r\n  }\r\n})\r\n\r\nlet updatePreview: UpdatePreview | undefined\r\n\r\nipcRenderer.on<'update-preview'>(\r\n  'update-preview',\r\n  (_event, { id, html, renderLaTeX }) => {\r\n    // div.update-preview created after constructor st UpdatePreview cannot\r\n    // be instanced in the constructor\r\n    const preview = document.querySelector('div.update-preview')\r\n    if (!preview) return\r\n    if (!updatePreview) {\r\n      updatePreview = new UpdatePreview(preview as HTMLElement)\r\n    }\r\n    const parser = new DOMParser()\r\n    const domDocument = parser.parseFromString(html, 'text/html')\r\n    util.handlePromise(\r\n      updatePreview.update(domDocument.body, renderLaTeX).then(async () => {\r\n        ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n          id,\r\n          request: 'update-preview',\r\n          result: await processHTMLString(preview),\r\n        })\r\n      }),\r\n    )\r\n    const doc = document\r\n    if (doc && domDocument.head.hasChildNodes) {\r\n      let container = doc.head.querySelector('original-elements')\r\n      if (!container) {\r\n        container = doc.createElement('original-elements')\r\n        doc.head.appendChild(container)\r\n      }\r\n      container.innerHTML = ''\r\n      for (const headElement of Array.from(domDocument.head.childNodes)) {\r\n        container.appendChild(headElement)\r\n      }\r\n    }\r\n  },\r\n)\r\n\r\nconst baseElement = document.createElement('base')\r\ndocument.head.appendChild(baseElement)\r\n\r\nipcRenderer.on<'set-base-path'>('set-base-path', (_evt, { path }) => {\r\n  if (path) baseElement.href = path\r\n  else baseElement.href = ''\r\n})\r\n\r\nipcRenderer.on<'error'>('error', (_evt, { msg }) => {\r\n  const preview = document.querySelector('div.update-preview')\r\n  if (!preview) return\r\n  const errorDiv = document.createElement('div')\r\n  errorDiv.innerHTML = `<h2>Previewing Markdown Failed</h2><h3>${msg}</h3>`\r\n  preview.appendChild(errorDiv)\r\n})\r\n\r\ndocument.addEventListener('mousewheel', (event) => {\r\n  if (event.ctrlKey) {\r\n    if (event.wheelDeltaY > 0) {\r\n      ipcRenderer.sendToHost<'zoom-in'>('zoom-in', undefined)\r\n    } else if (event.wheelDeltaY < 0) {\r\n      ipcRenderer.sendToHost<'zoom-out'>('zoom-out', undefined)\r\n    }\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n  }\r\n})\r\n\r\ndocument.addEventListener('scroll', (_event) => {\r\n  const el = document.documentElement\r\n  const height = el.clientHeight\r\n  const visible = Array.from(window.atomVars.sourceLineMap.entries())\r\n    .filter(([_line, elem]) => {\r\n      const { top, bottom } = elem.getBoundingClientRect()\r\n      return top > 0 && bottom < height\r\n    })\r\n    .map(([line, _elem]) => line)\r\n  ipcRenderer.sendToHost<'did-scroll-preview'>('did-scroll-preview', {\r\n    max: Math.max(...visible),\r\n    min: Math.min(...visible),\r\n  })\r\n})\r\n\r\nlet lastContextMenuTarget: HTMLElement\r\ndocument.addEventListener('contextmenu', (e) => {\r\n  lastContextMenuTarget = e.target as HTMLElement\r\n})\r\n\r\nipcRenderer.on<'sync-source'>('sync-source', (_, { id }) => {\r\n  let element = lastContextMenuTarget\r\n  const rsm = window.atomVars.revSourceMap\r\n  let lines = rsm.get(element)\r\n\r\n  while (!lines && element.parentElement) {\r\n    element = element.parentElement\r\n    lines = rsm.get(element)\r\n  }\r\n  if (!lines) return\r\n\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'sync-source',\r\n    result: Math.min(...lines),\r\n  })\r\n})\r\n\r\nipcRenderer.on<'reload'>('reload', (_, { id }) => {\r\n  window.onbeforeunload = null\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'reload',\r\n    result: undefined,\r\n  })\r\n})\r\n\r\nwindow.onbeforeunload = function() {\r\n  return false\r\n}\r\n\r\nipcRenderer.on<'get-tex-config'>('get-tex-config', async (_, { id }) => {\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'get-tex-config',\r\n    result: await jaxTeXConfig(),\r\n  })\r\n})\r\n\r\nipcRenderer.on<'set-width'>('set-width', async (_, { id, width }) => {\r\n  if (width === undefined) {\r\n    document.documentElement.style.removeProperty('width')\r\n  } else {\r\n    document.documentElement.style.setProperty(\r\n      'width',\r\n      `${width}mm`,\r\n      'important',\r\n    )\r\n  }\r\n  await rerenderMath()\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'set-width',\r\n    result: undefined,\r\n  })\r\n})\r\n\r\nipcRenderer.on<'get-selection'>('get-selection', async (_, { id }) => {\r\n  const selection = window.getSelection()\r\n  const selectedText = selection.toString()\r\n  const selectedNode = selection.baseNode\r\n\r\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\r\n    id,\r\n    request: 'get-selection',\r\n    result: selectedText && selectedNode ? selectedText : undefined,\r\n  })\r\n})\r\n"]}