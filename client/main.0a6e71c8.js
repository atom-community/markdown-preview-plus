parcelRequire=function(e,r,n){var t="function"==typeof parcelRequire&&parcelRequire,i="function"==typeof require&&require;function u(n,o){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!o&&f)return f(n,!0);if(t)return t(n,!0);if(i&&"string"==typeof n)return i(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}a.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,a,l,l.exports)}return r[n].exports;function a(e){return u(a.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=t;for(var o=0;o<n.length;o++)u(n[o]);return u}({5:[function(require,module,exports) {
"use strict";function e(e){e&&e.catch(function(e){console.error(e)})}exports.__esModule=!0,exports.handlePromise=e;var r=require("fs");function t(e){return!!r.existsSync(e)&&r.lstatSync(e).isFile()}function n(e,r){for(var t=e,n=0,o=r;n<o.length;n++){var s=o[n],i=t.querySelectorAll(":scope > "+s.tag).item(s.index);if(!i)break;t=i}if(t!==e)return t}exports.isFileSync=t,exports.resolveElement=n;
},{}],15:[function(require,module,exports) {
"use strict";function e(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,s){return function n(r,i){try{var l=t[r](i),o=l.value}catch(e){return void s(e)}if(!l.done)return Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)});e(o)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const t=require("tslib"),s=t.__importStar(require("fs")),n=require("atom"),r=require("electron"),i=require("file-uri-to-path"),l=require("../util");class o{constructor(t){var s;this.emitter=new n.Emitter,this.disposables=new n.CompositeDisposable,this.destroyed=!1,this.zoomLevel=0,this.replyCallbacks=new Map,this.replyCallbackId=0,this._element=document.createElement("webview"),this._element.classList.add("markdown-preview-plus","native-key-bindings"),this._element.disablewebsecurity="true",this._element.nodeintegration="true",this._element.src=`file:///${__dirname}/../../client/template.html`,this._element.style.width="100%",this._element.style.height="100%",this._element.addEventListener("ipc-message",e=>{switch(e.channel){case"zoom-in":this.zoomIn();break;case"zoom-out":this.zoomOut();break;case"did-scroll-preview":this.emitter.emit("did-scroll-preview",e.args[0]);break;case"request-reply":{var t=e.args[0];const s=t.id,n=t.request,r=t.result,i=this.replyCallbacks.get(s);if(i&&n===i.request){(0,i.callback)(r)}break}}}),this._element.addEventListener("will-navigate",(s=e(function*(e){e.url.startsWith("file://")?l.handlePromise(atom.workspace.open(i(e.url))):r.shell.openExternal(e.url)}),function(e){return s.apply(this,arguments)})),this.disposables.add(atom.styles.onDidAddStyleElement(()=>{this.updateStyles()}),atom.styles.onDidRemoveStyleElement(()=>{this.updateStyles()}),atom.styles.onDidUpdateStyleElement(()=>{this.updateStyles()}));this._element.addEventListener("dom-ready",()=>{this.destroyed||(this._element.setZoomLevel(this.zoomLevel),this.updateStyles(),t())})}get element(){return this._element}runJS(t){var s=this;return e(function*(){return new Promise(function(e){return s._element.executeJavaScript(t,!1,e)})})()}destroy(){this.destroyed||(this.destroyed=!0,this.disposables.dispose(),this._element.remove())}update(t,s,n){var r=this;return e(function*(){if(!r.destroyed)return r.runRequest("update-preview",{html:t,renderLaTeX:s,mjrenderer:n})})()}setSourceMap(e){this._element.send("set-source-map",{map:e})}setUseGitHubStyle(e){this._element.send("use-github-style",{value:e})}setBasePath(e){this._element.send("set-base-path",{path:e})}init(e,t){this._element.send("init",{atomHome:e,numberEqns:t})}updateImages(e,t){this._element.send("update-images",{oldsrc:e,v:t})}saveToPDF(e){this._element.printToPDF({},(t,n)=>{t?atom.notifications.addError("Failed saving to PDF",{description:t.toString(),dismissable:!0,stack:t.stack}):s.writeFileSync(e,n)})}sync(e){this._element.send("sync",{line:e})}syncSource(){var t=this;return e(function*(){return t.runRequest("sync-source",{})})()}scrollSync(e,t){this._element.send("scroll-sync",{firstLine:e,lastLine:t})}zoomIn(){this.zoomLevel+=.1,this._element.setZoomLevel(this.zoomLevel)}zoomOut(){this.zoomLevel-=.1,this._element.setZoomLevel(this.zoomLevel)}resetZoom(){this.zoomLevel=0,this._element.setZoomLevel(this.zoomLevel)}print(){this._element.print()}openDevTools(){this._element.openDevTools()}reload(){var t=this;return e(function*(){yield t.runRequest("reload",{}),t._element.reload()})()}error(e){this._element.send("error",{msg:e})}getTeXConfig(){var t=this;return e(function*(){return t.runRequest("get-tex-config",{})})()}runRequest(t,s){var n=this;return e(function*(){const e=n.replyCallbackId++;return new Promise(function(r){n.replyCallbacks.set(e,{request:t,callback:function(t){n.replyCallbacks.delete(e),r(t)}});const i=Object.assign({id:e},s);n._element.send(t,i)})})()}updateStyles(){const e=[];var t=!0,s=!1,n=void 0;try{for(var r,i=atom.styles.getStyleElements()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){const t=r.value;e.push(t.innerHTML)}}catch(e){s=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(s)throw n}}this._element.send("style",{styles:e})}}exports.WebviewHandler=o;
},{"../util":11}],20:[function(require,module,exports) {
"use strict";let n=(()=>{var n=t(function*(n,t,e){var o=u(t,e);const i=o.args,a=o.opts;return new Promise(function(t,o){const s=r.execFile(c.atomConfig().pandocConfig.pandocPath,h(i),a,function(n,r,i){n&&(atom.notifications.addError(n.toString(),{stack:n.stack,dismissable:!0}),o(n));try{const n=m(i||"",r||"",e);t(n)}catch(n){o(n)}});s.stdin.write(n),s.stdin.end()})});return function(t,e,r){return n.apply(this,arguments)}})();function t(n){return function(){var t=n.apply(this,arguments);return new Promise(function(n,e){return function r(o,i){try{var c=t[o](i),a=c.value}catch(n){return void e(n)}if(!c.done)return Promise.resolve(a).then(function(n){r("next",n)},function(n){r("throw",n)});n(a)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const e=require("lodash"),r=require("child_process"),o=require("fs"),i=require("path"),c=require("./util"),a=function(){let n=null;return function(){if(null!==n)return n;try{return n=require.resolve("mathjax")}catch(n){return""}}}();function s(n,t){const r=i.join(n,"../",t);if(o.existsSync(r))return r;{const o=i.join(r,"..");return o!==n&&!e.includes(atom.project.getPaths(),o)&&s(o,t)}}function u(n,t){const e={maxBuffer:1/0};void 0!==n&&(e.cwd=i.dirname(n));const r=a(),o=c.atomConfig().pandocConfig,u={from:o.pandocMarkdownFlavor,to:"html",mathjax:t?r:void 0,filter:o.pandocFilters};if(o.pandocBibliography){u.filter.push("pandoc-citeproc");let t=n&&s(n,o.pandocBIBFile);t||(t=o.pandocBIBFileFallback),u.bibliography=t||void 0;let e=n&&s(n,o.pandocCSLFile);e||(e=o.pandocCSLFileFallback),u.csl=e||void 0}return{args:u,opts:e}}function l(n,t,e){const r=new Error(n);throw r.html=p(t,e),r}function f(n){const t=document.createElement("div");return t.innerHTML=n,t.querySelectorAll(".math").forEach(function(n){let t=n.innerText;const e=t.indexOf("\\[")>-1?"; mode=display":"";return t=t.replace(/\\[[()\]]/g,""),n.outerHTML='<span class="math">'+`<script type='math/tex${e}'>${t}<\/script>`+"</span>"}),t.innerHTML}function d(n){const t=document.createElement("div");return t.innerHTML=n,t.querySelectorAll(".references").forEach(n=>{n.remove()}),t.innerHTML}function p(n,t){return t&&(n=f(n)),c.atomConfig().pandocConfig.pandocRemoveReferences&&(n=d(n)),n}function m(n,t,e){return n?l(n,t,e):p(t,e)}function h(n){const t=e.reduce(n,function(n,t,r){if(t&&!e.isEmpty(t)){const o=e.flatten([t]);e.forEach(o,function(t){e.isEmpty(t)||n.push(`--${r}=${t}`)})}return n},[]),r=[];for(var o=[...t,...c.atomConfig().pandocConfig.pandocArguments],i=0;i<o.length;i++){const n=o[i].replace(/^(--[\w\-]+)\s(.+)$/i,"$1=$2");"-"===n.substr(0,1)&&r.push(n)}return r}exports.renderPandoc=n,exports.testing={setPandocOptions:u,getArguments:h,findFileRecursive:s};
},{"./util":11}],41:[function(require,module,exports) {
"use strict";function t(t,e){const n=t.bMarks[e]+t.blkIndent,r=t.eMarks[e];return t.src.substr(n,r-n)}function e(t,e,n){const r=[];let s=0;const u=t.length;let h,i,l=0,o=0,p=0,a=!1,c=-1,d=-1;for(h=t.charCodeAt(s),i=function(e){return t.substring(s,s+e.length)===e};s<u;)c=e.map(i).indexOf(!0),d=n.map(i).indexOf(!0),c>-1&&l%2==0&&!a?(a=!a,p=s+e[c].length-1,s+=e[c].length-1):d>-1&&l%2==0&&a?(a=!a,p=s+n[d].length-1,s+=n[d].length-1):124!==h||l%2!=0||a?92===h?l++:l=0:(r.push(t.substring(o,s)),o=s+1),++s===u&&a&&(a=!1,s=p+1),h=t.charCodeAt(s);return r.push(t.substring(o)),r}function n(n,r,s,u,h,i){let l,o,p,a,c,d,f,b,g,m,_,k;if(u+2>h)return!1;if(c=u+1,s.sCount[c]<s.blkIndent)return!1;if((p=s.bMarks[c]+s.tShift[c])>=s.eMarks[c])return!1;if(124!==(l=s.src.charCodeAt(p))&&45!==l&&58!==l)return!1;if(o=t(s,u+1),!/^[-:| ]+$/.test(o))return!1;for(d=o.split("|"),g=[],a=0;a<d.length;a++){if(!(m=d[a].trim())){if(0===a||a===d.length-1)continue;return!1}if(!/^:?-+:?$/.test(m))return!1;58===m.charCodeAt(m.length-1)?g.push(58===m.charCodeAt(0)?"center":"right"):58===m.charCodeAt(0)?g.push("left"):g.push("")}if(-1===(o=t(s,u).trim()).indexOf("|"))return!1;if((f=(d=e(o.replace(/^\||\|$/g,""),n,r)).length)>g.length)return!1;if(i)return!0;for((b=s.push("table_open","table",1)).map=_=[u,0],(b=s.push("thead_open","thead",1)).map=[u,u+1],(b=s.push("tr_open","tr",1)).map=[u,u+1],a=0;a<d.length;a++)(b=s.push("th_open","th",1)).map=[u,u+1],g[a]&&(b.attrs=[["style","text-align:"+g[a]]]),(b=s.push("inline","",0)).content=d[a].trim(),b.map=[u,u+1],b.children=[],b=s.push("th_close","th",-1);for(b=s.push("tr_close","tr",-1),b=s.push("thead_close","thead",-1),(b=s.push("tbody_open","tbody",1)).map=k=[u+2,0],c=u+2;c<h&&!(s.sCount[c]<s.blkIndent)&&-1!==(o=t(s,c).trim()).indexOf("|");c++){for(d=e(o.replace(/^\||\|$/g,""),n,r),b=s.push("tr_open","tr",1),a=0;a<f;a++)b=s.push("td_open","td",1),g[a]&&(b.attrs=[["style","text-align:"+g[a]]]),(b=s.push("inline","",0)).content=d[a]?d[a].trim():"",b.children=[],b=s.push("td_close","td",-1);b=s.push("tr_close","tr",-1)}return b=s.push("tbody_close","tbody",-1),b=s.push("table_close","table",-1),_[1]=k[1]=c,s.line=c,!0}function r(t){const e=t.inlineDelim.map(t=>t[0]),r=t.inlineDelim.map(t=>t[1]);return e.unshift("`"),r.unshift("`"),n.bind(null,e,r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeTable=r;
},{}],32:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./lib/table");function n(e,n){const t=e.src.slice(e.pos,e.pos+5),r=e.pos;if("\\text"===t){for(e.pos+=5;" "===e.src[e.pos];)e.pos++;if("{"!==e.src[e.pos])e.pos=r;else for(;"}"!==e.src[e.pos]&&e.pos<n;)e.pos++}}function t(e,n,t){let r,s,i,o,c,l,a,p,u,f=n,h=!0,m=!0;const d=e.posMax,k=e.md.utils.isWhiteSpace,b=e.md.utils.isPunctChar,g=e.md.utils.isMdAsciiPunct;return r=n>0?e.src.charCodeAt(n-1):32,f>=d&&(o=!1),i=(f+=t)-n,s=f<d?e.src.charCodeAt(f):32,a=g(r)||b(String.fromCharCode(r)),u=g(s)||b(String.fromCharCode(s)),l=k(r),(p=k(s))?h=!1:u&&(l||a||(h=!1)),l?m=!1:a&&(p||u||(m=!1)),{can_open:o=h,can_close:c=m,delims:i}}function r(e){return function(r,s){let i,o,c,l,a;const p=r.posMax,u=r.pos,f=e.find(function(e){const n=e[0];return r.src.slice(u,u+n.length)===n});if(!f)return!1;const h=f[0],m=f[1];if(s)return!1;if(i=(c=t(r,u,h.length)).delims,!c.can_open)return r.pos+=i,r.pending+=r.src.slice(u,r.pos),!0;for(r.pos=u+h.length;r.pos<p;){if((a=r.src.slice(r.pos,r.pos+m.length))===m&&(c=t(r,r.pos,m.length)).can_close){o=!0;break}n(r,p),r.md.inline.skipToken(r)}return o?(r.posMax=r.pos,r.pos=u+m.length,(l=r.push("math_inline","math",0)).content=r.src.slice(r.pos,r.posMax),l.markup=h,r.pos=r.posMax+m.length,r.posMax=p,!0):(r.pos=u,!1)}}function s(e){return function(n,t,r,s){let i,o,c,l,a,p,u,f=!1,h=!1,m=n.bMarks[t]+n.tShift[t],d=n.eMarks[t];const k=e.find(function(e){const t=e[0];return n.src.slice(m,m+t.length)===t});if(!k)return!1;const b=k[0];let g=k[1];if("\n"===g[0]&&(h=!0,g=g.slice(1)),m+b.length>d+1)return!1;if(m+=b.length,l=n.src.slice(m,d),s)return!0;for(l.trim().slice(-g.length)===g&&(l=l.trim().slice(0,-g.length),f=!0),o=t;!f&&!(++o>=r)&&(m=n.bMarks[o]+n.tShift[o],d=n.eMarks[o],!(m<d&&n.tShift[o]<n.blkIndent));)(u=h?n.src.slice(m,d).trim():n.src.slice(m,d).trim().slice(-g.length))===g&&(n.tShift[o]-n.blkIndent>=4||(p=n.src.slice(0,d).lastIndexOf(g),a=n.src.slice(m,p),m+=a.length+g.length,(m=n.skipSpaces(m))<d||(f=!0)));return i=n.tShift[t],n.line=o+(f?1:0),(c=n.push("math_block","math",0)).block=!0,c.content=(l&&l.trim()?l+"\n":"")+n.getLines(t+1,o,i,!0)+(a&&a.trim()?a:""),c.map=[t,n.line],c.markup=b,!0}}function i(e={}){return"block"===e.display?function(e,n){return'<div class="math block">'+e[n].content+"</div>\n"}:function(e,n){return'<span class="math inline">'+e[n].content+"</span>"}}function o(n,t={}){const o=t.inlineDelim||[["$$","$$"]],c=t.blockDelim||[["$$$","$$$"]],l=t.inlineRenderer,a=t.blockRenderer,p=l?function(e,n){return l(e[n].content)}:i(t.renderingOptions),u=a?function(e,n){return a(e[n].content)+"\n"}:i(Object.assign({display:"block"},t.renderingOptions)),f=r(o),h=s(c);n.inline.ruler.before("escape","math_inline",f),n.block.ruler.after("blockquote","math_block",h,{alt:["paragraph","reference","blockquote","list"]}),n.renderer.rules.math_inline=p,n.renderer.rules.math_block=u;const m=e.makeTable({inlineDelim:o,blockDelim:c});n.block.ruler.at("table",m,{alt:["paragraph","reference"]})}exports.math_plugin=o;
},{"./lib/table":41}],21:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("tslib"),r=require("markdown-it"),t=e.__importStar(require("twemoji")),n=e.__importStar(require("path")),a=require("./util"),i=e.__importStar(require("lodash"));function o(e){return`<span class='math'><script type='math/tex'>${e}<\/script></span>`}function s(e){return`<span class='math'><script type='math/tex; mode=display'>${e}<\/script></span>`}function u(e){return{html:!0,xhtmlOut:!1,breaks:e,langPrefix:"lang-",linkify:!0,typographer:!0}}function l(e){const r=a.atomConfig().markdownItConfig;return{renderLaTeX:e,lazyHeaders:r.useLazyHeaders,checkBoxes:r.useCheckBoxes,toc:r.useToc,emoji:r.useEmoji,breaks:r.breakOnSingleNewline,inlineMathSeparators:r.inlineMathSeparators,blockMathSeparators:r.blockMathSeparators}}function c(e){const i=r(u(e.breaks));if(e.renderLaTeX){const r=a.pairUp(e.inlineMathSeparators,"inlineMathSeparators"),t=a.pairUp(e.blockMathSeparators,"blockMathSeparators");i.use(require("./markdown-it-math").math_plugin,{inlineDelim:r,blockDelim:t,inlineRenderer:o,blockRenderer:s})}return e.lazyHeaders&&i.use(require("markdown-it-lazy-headers")),e.checkBoxes&&i.use(require("markdown-it-task-lists")),e.toc&&i.use(require("markdown-it-table-of-contents")),e.emoji&&(i.use(require("markdown-it-emoji")),i.renderer.rules.emoji=function(e,r){return t.parse(e[r].content,{folder:"svg",ext:".svg",base:n.dirname(require.resolve("twemoji"))+n.sep})}),i}function p(e){let r=null,t=null;return function(n){return null!==r&&i.isEqual(t,n)||(t=n,r=e(n)),r}}const m=p(c);function d(e,r){return m(l(r)).render(e)}function h(e,r){return m(l(r)).parse(e,{})}exports.render=d,exports.getTokens=h;
},{"./util":11,"./markdown-it-math":32}],22:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const s={sh:"source.shell",bash:"source.shell",c:"source.c","c++":"source.cpp",cpp:"source.cpp",coffee:"source.coffee",coffeescript:"source.coffee","coffee-script":"source.coffee",cs:"source.cs",csharp:"source.cs",css:"source.css",scss:"source.css.scss",sass:"source.sass",erlang:"source.erl",go:"source.go",html:"text.html.basic",java:"source.java",js:"source.js",javascript:"source.js",json:"source.json",less:"source.less",mustache:"text.html.mustache",objc:"source.objc","objective-c":"source.objc",php:"text.html.php",py:"source.python",python:"source.python",rb:"source.ruby",ruby:"source.ruby",text:"text.plain",toml:"source.toml",xml:"text.xml",yaml:"source.yaml",yml:"source.yaml"};function e(e){const c=e.toLowerCase();return s[c]||`source.${c}`}exports.scopeForFenceName=e;
},{}],50:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("tslib"),t=e.__importStar(require("path")),r=e.__importStar(require("fs")),n=require("../util");function o(e){var t=!0,r=!1,n=void 0;try{for(var o,i=atom.workspace.getTextEditors()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){const t=o.value;if(t.id===e)return t}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}}exports.editorForId=o;let i=void 0;function a(e){i=e}function l(e){if(i)return i(e);const t=document.createElement("atom-styles");return t.initialize(atom.styles),t.setAttribute("context",e),Array.from(t.childNodes).map(e=>e.innerText)}function s(){return["body { padding: 0; margin: 0; }"].concat(l("markdown-preview-plus")).concat(l("atom-text-editor")).join("\n").replace(/\batom-text-editor\b/g,"pre.editor-colors").replace(/\bmarkdown-preview-plus-view\b/g,".markdown-preview-plus-view").replace(/\b\.\.markdown-preview-plus-view\b/g,".markdown-preview-plus-view").replace(/url\(atom:\/\/markdown-preview-plus\/assets\/(.*)\)/,function(e,n,o,i){const a=t.join(__dirname,"../../assets",n),l=r.readFileSync(a,"binary");return`url('data:image/jpeg;base64,${new Buffer(l,"binary").toString("base64")}')`})}function u(e){return"math"===e.tag?"span":"code"===e.tag?"atom-text-editor":""===e.tag?null:e.tag}function c(e){const t={},r={0:{}};var n=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){const e=a.value;if(e.hidden)continue;if(null==e.map)continue;const n=u(e);if(null===n)continue;if(1===e.nesting){for(let o=e.map[0];o<e.map[1];o+=1)null==t[o]&&(t[o]=[]),t[o].push({tag:n,index:r[e.level][n]||0});r[e.level+1]={}}else if(0===e.nesting)for(let o=e.map[0];o<e.map[1];o+=1)null==t[o]&&(t[o]=[]),t[o].push({tag:n,index:r[e.level][n]||0});const o=r[e.level][n];r[e.level][n]=o?o+1:1}}catch(e){o=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw i}}return t}function p(e){}function d(e,t,r,n,o){let i;i=r?p(o):""}function m(e){const t=atom.workspace.paneForItem(e);t&&n.handlePromise(t.destroyItem(e))}exports.__setGetStylesOverride=a,exports.getStyles=l,exports.buildLineMap=c,exports.mkHtml=d,exports.destroy=m;
},{"../util":11}],40:[function(require,module,exports) {
"use strict";function e(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const t=require("tslib"),r=require("path"),n=require("atom"),i=require("lodash"),o=require("fs"),a=require("../renderer"),s=require("../markdown-it-helper"),d=require("../image-watch-helper"),h=require("../util"),l=t.__importStar(require("./util")),m=require("./webview-handler");class u{constructor(e="normal",t=h.atomConfig().mathConfig.enableLatexRenderingByDefault){this.defaultRenderMode=e,this.renderLaTeX=t,this.emitter=new n.Emitter,this.disposables=new n.CompositeDisposable,this.destroyed=!1,this.loading=!0,this.changeHandler=(()=>{h.handlePromise(this.renderMarkdown());const e=atom.workspace.paneForItem(this);void 0!==e&&e!==atom.workspace.getActivePane()&&e.activateItem(this)}),this.renderPromise=new Promise(e=>{this.handler=new m.WebviewHandler(()=>{this.handler.init(atom.getConfigDirPath(),h.atomConfig().mathConfig.numberEquations),this.handler.setUseGitHubStyle(atom.config.get("markdown-preview-plus.useGitHubStyle")),this.handler.setBasePath(this.getPath()),this.emitter.emit("did-change-title"),e(this.renderMarkdown())}),u.elementMap.set(this.element,this)}),this.runJS=this.handler.runJS.bind(this.handler),this.handleEvents(),this.handler.emitter.on("did-scroll-preview",({min:e,max:t})=>{this.didScrollPreview(e,t)})}get element(){return this.handler.element}static viewForElement(e){return u.elementMap.get(e)}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this.getPath();e&&d.removeFile(e),this.disposables.dispose(),this.handler.destroy(),u.elementMap.delete(this.element)}onDidChangeTitle(e){return this.emitter.on("did-change-title",e)}onDidChangeMarkdown(e){return this.emitter.on("did-change-markdown",e)}toggleRenderLatex(){this.renderLaTeX=!this.renderLaTeX,this.changeHandler()}refreshImages(t){var r=this;return e(function*(){const e=yield d.getVersion(t,r.getPath());r.handler.updateImages(t,e)})()}getDefaultLocation(){return h.atomConfig().previewConfig.previewDock}getIconName(){return"markdown"}getSaveDialogOptions(){let e=this.getPath();if(void 0===e){const t=atom.project.getPaths()[0];e="untitled.md",t&&(e=r.join(t,e))}return{defaultPath:e+="."+h.atomConfig().saveConfig.defaultSaveFormat}}saveAs(t){var n=this;if(void 0===t)return;if(this.loading)throw new Error("Preview is still loading");var i=r.parse(t);const a=i.name;var s;".pdf"===i.ext?this.handler.saveToPDF(t):h.handlePromise(this.getHTMLToSave(t).then((s=e(function*(e){const r=l.mkHtml(a,e,n.renderLaTeX,atom.config.get("markdown-preview-plus.useGitHubStyle"),yield n.handler.getTeXConfig());return o.writeFileSync(t,r),atom.workspace.open(t)}),function(e){return s.apply(this,arguments)})))}didScrollPreview(e,t){}openSource(e){const t=this.getPath();void 0!==t&&h.handlePromise(atom.workspace.open(t,{initialLine:e,searchAllPanes:!0}))}syncPreview(e){this.handler.sync(e)}openNewWindow(){const e=this.getPath();e?(atom.open({pathsToOpen:[`markdown-preview-plus://file/${e}`],newWindow:!0}),l.destroy(this)):atom.notifications.addWarning("Can not open this preview in new window: no file path")}handleEvents(){var t,r=this;this.disposables.add(atom.grammars.onDidAddGrammar(()=>i.debounce(()=>{h.handlePromise(this.renderMarkdown())},250)),atom.grammars.onDidUpdateGrammar(i.debounce(()=>{h.handlePromise(this.renderMarkdown())},250))),this.disposables.add(atom.commands.add(this.element,{"core:move-up":()=>this.element.scrollBy({top:-10}),"core:move-down":()=>this.element.scrollBy({top:10}),"core:copy":e=>{this.copyToClipboard()&&e.stopPropagation()},"markdown-preview-plus:open-dev-tools":()=>{this.handler.openDevTools()},"markdown-preview-plus:new-window":()=>{this.openNewWindow()},"markdown-preview-plus:print":()=>{this.handler.print()},"markdown-preview-plus:zoom-in":()=>{this.handler.zoomIn()},"markdown-preview-plus:zoom-out":()=>{this.handler.zoomOut()},"markdown-preview-plus:reset-zoom":()=>{this.handler.resetZoom()},"markdown-preview-plus:sync-source":(t=e(function*(e){const t=yield r.handler.syncSource();r.openSource(t)}),function(e){return t.apply(this,arguments)})})),this.disposables.add(atom.config.onDidChange("markdown-preview-plus.markdownItConfig",()=>{"markdown-it"===h.atomConfig().renderer&&this.changeHandler()}),atom.config.onDidChange("markdown-preview-plus.pandocConfig",()=>{"pandoc"===h.atomConfig().renderer&&this.changeHandler()}),atom.config.onDidChange("markdown-preview-plus.mathConfig.latexRenderer",this.changeHandler),atom.config.onDidChange("markdown-preview-plus.mathConfig.numberEquations",()=>{h.handlePromise(this.handler.reload())}),atom.config.onDidChange("markdown-preview-plus.renderer",this.changeHandler),atom.config.onDidChange("markdown-preview-plus.useGitHubStyle",({newValue:e})=>{this.handler.setUseGitHubStyle(e)}))}renderMarkdown(){var t=this;return e(function*(){const e=yield t.getMarkdownSource();yield t.renderMarkdownText(e)})()}getHTMLToSave(t){var r=this;return e(function*(){const e=yield r.getMarkdownSource();return a.render(e,r.getPath(),r.getGrammar(),r.renderLaTeX,"save",t)})()}renderMarkdownText(t){var r=this;return e(function*(){try{const e=yield a.render(t,r.getPath(),r.getGrammar(),r.renderLaTeX,r.defaultRenderMode);if(r.destroyed)return;r.loading=!1,h.handlePromise(r.handler.update(e.documentElement.outerHTML,r.renderLaTeX,h.atomConfig().mathConfig.latexRenderer)),r.handler.setSourceMap(l.buildLineMap(s.getTokens(t,r.renderLaTeX))),r.emitter.emit("did-change-markdown")}catch(e){r.showError(e)}})()}showError(e){this.destroyed?atom.notifications.addFatalError("Error reported on a destroyed Markdown Preview Plus view",{dismissable:!0,stack:e.stack,detail:e.message}):this.handler.error(e.message)}copyToClipboard(){var t=this;if(this.loading)return!1;const r=window.getSelection(),n=r.toString(),i=r.baseNode;return(!n||null==i)&&(h.handlePromise(this.getMarkdownSource().then((o=e(function*(e){return h.copyHtml(e,t.getPath(),t.renderLaTeX)}),function(e){return o.apply(this,arguments)}))),!0);var o}}u.elementMap=new WeakMap,exports.MarkdownPreviewView=u;
},{"../renderer":14,"../markdown-it-helper":21,"../image-watch-helper":23,"../util":11,"./util":50,"./webview-handler":15}],57:[function(require,module,exports) {
"use strict";function r(r){return function(){var e=r.apply(this,arguments);return new Promise(function(r,i){return function n(t,o){try{var d=e[t](o),u=d.value}catch(r){return void i(r)}if(!d.done)return Promise.resolve(u).then(function(r){n("next",r)},function(r){n("throw",r)});r(u)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const e=require("electron");class i{constructor(r,i){this.windowId=r,this.editorId=i,this.ipcIdx=0,this.myWindowId=e.remote.getCurrentWindow().id}scrollToBufferRange(e){var i=this;return r(function*(){return i.ipc("scrollToBufferRange",e)})()}destroy(){var e=this;return r(function*(){return e.ipc("destroy",void 0)})()}init(){var e=this;return r(function*(){return e.ipc("init",void 0)})()}openSource(e){var i=this;return r(function*(){return i.ipc("openSource",e)})()}dispose(){}ipc(i,n){var t=this;return r(function*(){return new Promise(function(r,o){const d=t.ipcIdx++;e.remote.ipcMain.emit("markdown-preview-plus:editor-request",{windowId:t.windowId,editorId:t.editorId,forWindowId:t.myWindowId,idx:d,cmd:i,args:n})?e.remote.ipcMain.on("markdown-preview-plus:editor-reply",function i(n){n.forWindowId===t.myWindowId&&n.windowId===t.windowId&&n.editorId===t.editorId&&n.idx===d&&(e.remote.ipcMain.removeListener("markdown-preview-plus:editor-reply",i),r(n.reply))}):o(new Error("Nobody is listening for editor requests"))})})()}}exports.IPCCaller=i;
},{}],58:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("electron");class r{constructor(r,t,i){this.windowId=r,this.editorId=t,this.handlers=i,this.handler=(e=>{if(this.editorId!==e.editorId||this.windowId!==e.windowId)return;(0,this.handlers[e.event])(e.arg)}),e.remote.ipcMain.on("markdown-preview-plus:editor-event",this.handler)}dispose(){e.remote.ipcMain.removeListener("markdown-preview-plus:editor-event",this.handler)}}exports.EventHandler=r;
},{}],59:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("electron");class d{constructor(d,i,r){this.windowId=d,this.editorId=i,this.handlers=r,this.handleRequest=(d=>{if(d.editorId!==this.editorId||d.windowId!==this.windowId)return;const i=(0,this.handlers[d.cmd])(d.args);e.remote.ipcMain.emit("markdown-preview-plus:editor-reply",{editorId:d.editorId,windowId:d.windowId,forWindowId:d.forWindowId,idx:d.idx,reply:i})}),e.remote.ipcMain.on("markdown-preview-plus:editor-request",this.handleRequest)}dispose(){e.remote.ipcMain.removeListener("markdown-preview-plus:editor-request",this.handleRequest)}}exports.RequestHandler=d;
},{}],61:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../../util"),r=require("electron");function o(o){const n=e.atomConfig().syncConfig;return n.syncEditorOnPreviewScroll&&n.syncPreviewOnEditorScroll?r.remote.getCurrentWindow().isFocused():n.syncEditorOnPreviewScroll&&"preview"===o||n.syncPreviewOnEditorScroll&&"editor"===o}exports.shouldScrollSync=o;
},{"../../util":11}],60:[function(require,module,exports) {
"use strict";var e=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,r=!1,s=void 0;try{for(var n,d=e[Symbol.iterator]();!(o=(n=d.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0});const t=require("atom"),i=require("electron"),o=require("./request-handler"),r=require("../../util"),s=require("./should-scroll-sync");class n{constructor(e){this.editor=e,this.disposables=new t.CompositeDisposable,this.windowId=i.remote.getCurrentWindow().id,this.destroyTimeoutLength=6e4,this.usageCounter=0,this.eventHandlers={scrollToBufferRange:([e,i])=>{if(0===e)this.editor.scrollToBufferPosition([e,0]);else if(i>=this.editor.getLastBufferRow()-1)this.editor.scrollToBufferPosition([i,0]);else{const o=t.Range.fromObject([[e,0],[i,0]]);this.editor.scrollToScreenRange(this.editor.screenRangeForBufferRange(o),{center:!1})}},destroy:()=>{this.usageCounter-=1,this.usageCounter<=0&&(this.resetTimeout(),this.destroyTimeout=window.setTimeout(()=>{this.dispose()},this.destroyTimeoutLength))},init:()=>(this.usageCounter+=1,this.resetTimeout(),{path:this.editor.getPath(),title:this.editor.getTitle(),grammar:this.editor.getGrammar().scopeName,text:this.editor.getText()}),openSource:e=>{void 0!==e&&this.editor.setCursorBufferPosition([e,0]),i.remote.getCurrentWindow().focus();const t=atom.workspace.paneForItem(this.editor);t&&(t.activateItem(this.editor),t.activate())}},this.disposables.add(new o.RequestHandler(this.windowId,e.id,this.eventHandlers)),this.handleEditorEvents()}static create(e){const t=n.editorMap.get(e);if(t)return t;const i=new n(e);return n.editorMap.set(e,i),i}dispose(){n.editorMap.delete(this.editor),this.disposables.dispose()}resetTimeout(){void 0!==this.destroyTimeout&&(window.clearTimeout(this.destroyTimeout),this.destroyTimeout=void 0)}handleEditorEvents(){this.disposables.add(this.editor.getBuffer().onDidStopChanging(()=>{r.atomConfig().previewConfig.liveUpdate&&this.emit("changeText",this.editor.getText()),r.atomConfig().syncConfig.syncPreviewOnChange&&this.emit("syncPreview",this.editor.getCursorBufferPosition().row)}),this.editor.onDidChangePath(()=>{this.emit("changePath",{path:this.editor.getPath(),title:this.editor.getTitle()})}),this.editor.onDidChangeGrammar(e=>{this.emit("changeGrammar",e.scopeName)}),this.editor.onDidDestroy(()=>{this.dispose(),r.atomConfig().previewConfig.closePreviewWithEditor&&this.emit("destroy",void 0)}),this.editor.getBuffer().onDidSave(()=>{r.atomConfig().previewConfig.liveUpdate||this.emit("changeText",this.editor.getText())}),this.editor.getBuffer().onDidReload(()=>{r.atomConfig().previewConfig.liveUpdate||this.emit("changeText",this.editor.getText())}),atom.views.getView(this.editor).onDidChangeScrollTop(()=>{if(!s.shouldScrollSync("editor"))return;var t=this.editor.getVisibleRowRange(),i=e(t,2);const o=i[0],r=i[1],n=this.editor.bufferRowForScreenRow(o),d=this.editor.bufferRowForScreenRow(r);this.emit("scrollSync",[n,d])}),atom.commands.add(atom.views.getView(this.editor),{"markdown-preview-plus:sync-preview":()=>{this.emit("syncPreview",this.editor.getCursorBufferPosition().row)}}))}emit(e,t){i.remote.ipcMain.emit("markdown-preview-plus:editor-event",{editorId:this.editor.id,windowId:this.windowId,event:e,arg:t})}}n.editorMap=new WeakMap,exports.RemoteEditorServer=n;
},{"./request-handler":59,"../../util":11,"./should-scroll-sync":61}],56:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./ipc-caller");exports.IPCCaller=e.IPCCaller;var r=require("./event-handler");exports.EventHandler=r.EventHandler;var l=require("./request-handler");exports.RequestHandler=l.RequestHandler;var t=require("./setup-editor");exports.RemoteEditorServer=t.RemoteEditorServer;var o=require("./should-scroll-sync");exports.shouldScrollSync=o.shouldScrollSync;
},{"./ipc-caller":57,"./event-handler":58,"./request-handler":59,"./setup-editor":60,"./should-scroll-sync":61}],51:[function(require,module,exports) {
"use strict";function t(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function r(n,o){try{var s=e[n](o),a=s.value}catch(t){return void i(t)}if(!s.done)return Promise.resolve(a).then(function(t){r("next",t)},function(t){r("throw",t)});t(a)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const e=require("tslib"),i=e.__importStar(require("./util")),r=require("./markdown-preview-view"),n=require("../util"),o=require("./ipc"),s=require("electron");class a extends r.MarkdownPreviewView{constructor(t,e){super(),this.windowId=t,this.editorId=e,this.text="",this.title="<Pending>",this.ipc=new o.IPCCaller(t,e),this.disposables.add(this.ipc),this.handleEditorEvents(),this.ipc.init().then(t=>{this.text=t.text,this.path=t.path,this.grammar=atom.grammars.grammarForScopeName(t.grammar),this.title=t.title,this.emitter.emit("did-change-title"),this.changeHandler()}).catch(t=>{atom.notifications.addError("Failed to open preview",{dismissable:!0,detail:t.toString(),stack:t.stack})})}static open(t){const e=s.remote.getCurrentWindow().id,i=t.id;atom.open({pathsToOpen:[`markdown-preview-plus://remote-editor/${e}/${i}`],newWindow:!0}),o.RemoteEditorServer.create(t)}destroy(){this.ipc.destroy().catch(d),super.destroy()}getTitle(){return`${this.title} Preview`}getURI(){return`markdown-preview-plus://remote-editor/${this.windowId}/${this.editorId}`}getPath(){return this.path}serialize(){}openNewWindow(){atom.open({pathsToOpen:[this.getURI()],newWindow:!0}),i.destroy(this)}getMarkdownSource(){var e=this;return t(function*(){return e.text})()}getGrammar(){return this.grammar}didScrollPreview(t,e){o.shouldScrollSync("preview")&&this.ipc.scrollToBufferRange([t,e]).catch(d)}openSource(t){this.ipc.openSource(t).catch(e=>{console.log(e);const i=this.getPath();i?n.handlePromise(atom.workspace.open(i,{initialLine:t})):atom.notifications.addWarning("Failed to sync source: no editor and no path")})}handleEditorEvents(){this.disposables.add(new o.EventHandler(this.windowId,this.editorId,{changeText:t=>{this.text=t,this.changeHandler()},syncPreview:t=>{this.syncPreview(t)},changePath:({title:t,path:e})=>{this.title=t,this.path=e,this.emitter.emit("did-change-title")},changeGrammar:t=>{this.grammar=atom.grammars.grammarForScopeName(t),this.emitter.emit("did-change-title")},destroy:()=>{i.destroy(this)},scrollSync:([t,e])=>{this.handler.scrollSync(t,e)}}))}}function d(){}exports.MarkdownPreviewViewEditorRemote=a;
},{"./util":50,"./markdown-preview-view":40,"../util":11,"./ipc":56}],38:[function(require,module,exports) {
"use strict";var e=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!0,o=!1,n=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(e){o=!0,n=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw n}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function t(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function i(o,n){try{var s=t[o](n),a=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(a).then(function(e){i("next",e)},function(e){i("throw",e)});e(a)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const r=require("tslib"),i=require("atom"),o=r.__importStar(require("./util")),n=require("./markdown-preview-view"),s=require("../util"),a=require("./markdown-preview-view-editor-remote");class d extends n.MarkdownPreviewView{constructor(e){var r;r=super(),this.editor=e,this.syncPreviewHelper=t(function*(){const e=r.editor.getCursorBufferPosition().row;r.syncPreview(e)}),this.handleEditorEvents()}static create(e){let t=d.editorMap.get(e);return t||(t=new d(e),d.editorMap.set(e,t)),t}static viewForEditor(e){return d.editorMap.get(e)}destroy(){super.destroy(),d.editorMap.delete(this.editor)}serialize(){return{deserializer:"markdown-preview-plus/MarkdownPreviewView",editorId:this.editor&&this.editor.id}}getTitle(){return`${this.editor.getTitle()} Preview`}getURI(){return`markdown-preview-plus://editor/${this.editor.id}`}getPath(){return this.editor.getPath()}getMarkdownSource(){var e=this;return t(function*(){return e.editor.getText()})()}getGrammar(){return this.editor.getGrammar()}didScrollPreview(e,t){if(this.shouldScrollSync("preview"))if(0===e)this.editor.scrollToBufferPosition([e,0]);else if(t>=this.editor.getLastBufferRow()-1)this.editor.scrollToBufferPosition([t,0]);else{const r=i.Range.fromObject([[e,0],[t,0]]);this.editor.scrollToScreenRange(this.editor.screenRangeForBufferRange(r),{center:!1})}}openNewWindow(){a.MarkdownPreviewViewEditorRemote.open(this.editor),o.destroy(this)}openSource(e){void 0!==e&&this.editor.setCursorBufferPosition([e,0]);const t=atom.workspace.paneForItem(this.editor);t&&(t.activateItem(this.editor),t.activate())}handleEditorEvents(){this.disposables.add(atom.workspace.onDidChangeActiveTextEditor(e=>{if(s.atomConfig().previewConfig.activatePreviewWithEditor&&e===this.editor){const t=atom.workspace.paneForItem(this);if(!t)return;if(t===atom.workspace.paneForItem(e))return;t.activateItem(this)}}),this.editor.getBuffer().onDidStopChanging(()=>{s.atomConfig().previewConfig.liveUpdate&&this.changeHandler(),s.atomConfig().syncConfig.syncPreviewOnChange&&s.handlePromise(this.syncPreviewHelper())}),this.editor.onDidChangePath(()=>{this.emitter.emit("did-change-title")}),this.editor.onDidDestroy(()=>{s.atomConfig().previewConfig.closePreviewWithEditor&&o.destroy(this)}),this.editor.getBuffer().onDidSave(()=>{s.atomConfig().previewConfig.liveUpdate||this.changeHandler()}),this.editor.getBuffer().onDidReload(()=>{s.atomConfig().previewConfig.liveUpdate||this.changeHandler()}),atom.views.getView(this.editor).onDidChangeScrollTop(()=>{if(!this.shouldScrollSync("editor"))return;var t=this.editor.getVisibleRowRange(),r=e(t,2);const i=r[0],o=r[1];this.handler.scrollSync(this.editor.bufferRowForScreenRow(i),this.editor.bufferRowForScreenRow(o))}),atom.commands.add(atom.views.getView(this.editor),{"markdown-preview-plus:sync-preview":this.syncPreviewHelper}))}shouldScrollSync(e){const t=s.atomConfig().syncConfig;if(t.syncEditorOnPreviewScroll&&t.syncPreviewOnEditorScroll){const t="editor"===e?this.editor:this,r=atom.workspace.paneForItem(t);return r&&r.isActive()}return t.syncEditorOnPreviewScroll&&"preview"===e||t.syncPreviewOnEditorScroll&&"editor"===e}}d.editorMap=new WeakMap,exports.MarkdownPreviewViewEditor=d;
},{"./util":50,"./markdown-preview-view":40,"../util":11,"./markdown-preview-view-editor-remote":51}],39:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function i(n,a){try{var o=r[n](a),s=o.value}catch(e){return void t(e)}if(!o.done)return Promise.resolve(s).then(function(e){i("next",e)},function(e){i("throw",e)});e(s)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const r=require("path"),t=require("atom"),i=require("./markdown-preview-view");class n extends i.MarkdownPreviewView{constructor(e){super(),this.file=new t.File(e),this.disposables.add(this.file.onDidChange(this.changeHandler))}serialize(){return{deserializer:"markdown-preview-plus/MarkdownPreviewView",filePath:this.file.getPath()}}getTitle(){const e=this.getPath();return`${e?r.basename(e):"Markdown File"} Preview`}getURI(){return`markdown-preview-plus://file/${this.getPath()}`}getPath(){return this.file.getPath()}getGrammar(){}getMarkdownSource(){var r=this;return e(function*(){const e=yield r.file.read();return null!==e?e:""})()}}exports.MarkdownPreviewViewFile=n;
},{"./markdown-preview-view":40}],33:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./markdown-preview-view-editor");exports.MarkdownPreviewViewEditor=e.MarkdownPreviewViewEditor;var r=require("./markdown-preview-view-file");exports.MarkdownPreviewViewFile=r.MarkdownPreviewViewFile;var i=require("./markdown-preview-view");exports.MarkdownPreviewView=i.MarkdownPreviewView,exports.SerializedMPV=i.SerializedMPV;
},{"./markdown-preview-view-editor":38,"./markdown-preview-view-file":39,"./markdown-preview-view":40}],23:[function(require,module,exports) {
"use strict";let e=(()=>{var e=n(function*(e,n){let r;const a=s[e];if(!a){if(o.isFileSync(e)){r=Date.now();const t=new i.CompositeDisposable,o=new i.File(e);return t.add(o.onDidChange(u(e,"change")),o.onDidDelete(u(e,"delete")),o.onDidRename(u(e,"rename"))),s[e]={path:e,watched:!0,files:n?[n]:[],version:r,watcher:t},r}return!1}const c=a.files;return n&&!t.includes(c,n)&&a.files.push(n),!(r=a.version)&&o.isFileSync(e)&&(r=Date.now(),a.version=r),r});return function(n,t){return e.apply(this,arguments)}})();function n(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function r(i,o){try{var s=n[i](o),a=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const t=require("lodash"),r=require("./markdown-preview-view"),i=require("atom"),o=require("./util");let s={};const a=t.debounce((()=>{var e=n(function*(e){var n=!0,t=!1,i=void 0;try{for(var o,s=atom.workspace.getPaneItems()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){const n=o.value;n instanceof r.MarkdownPreviewView&&(yield n.refreshImages(e))}}catch(e){t=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(t)throw i}}});return function(n){return e.apply(this,arguments)}})(),250);function u(e,n){return function(){const t=s[e];t&&("change"===n&&o.isFileSync(e)?t.version=Date.now():(t.watcher.dispose(),delete s[e]),o.handlePromise(a(e)))}}function c(e){s=t.mapValues(s,function(n){return n?(n.files=t.without(n.files,e),n.files=t.filter(n.files,o.isFileSync),t.isEmpty(n.files)&&(n.watched=!1,n.watcher.dispose()),n):n})}exports.removeFile=c,exports.getVersion=e;
},{"./markdown-preview-view":33,"./util":11}],6:[function(require,module,exports) {
"use strict";function e(e){return e.querySelectorAll("img[src],audio[src],video[src]")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMedia=e;
},{}],14:[function(require,module,exports) {
"use strict";var e=function(){return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var t=[],o=!0,n=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(o=(a=l.next()).done)&&(t.push(a.value),!r||t.length!==r);o=!0);}catch(e){n=!0,i=e}finally{try{!o&&l.return&&l.return()}finally{if(n)throw i}}return t}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();let r=(()=>{var e=n(function*(e,r,n,i,a,c){let u,d;if(e=e.replace(/^\s*<!doctype(\s+.*)?>\s*/i,""),"pandoc"===f.atomConfig().renderer)try{u=yield l.renderPandoc(e,r,i)}catch(e){const r=e;if(void 0===r.html)throw r;d=r.message,u=r.html}else u=s.render(e,i);const m=(new DOMParser).parseFromString(u,"text/html");if(p(m),"normal"===a)yield o(m,r,{version:!0,relativize:!1});else{let e;switch(a){case"save":e=f.atomConfig().saveConfig.mediaOnSaveAsHTMLBehaviour;break;case"copy":e=f.atomConfig().saveConfig.mediaOnCopyAsHTMLBehaviour;break;default:throw y(a)}yield t({doc:m,filePath:r,savePath:c,behaviour:e})}let v="text";if("source.litcoffee"===(n&&n.scopeName)&&(v="coffee"),"pandoc"===f.atomConfig().renderer&&f.atomConfig().pandocConfig.useNativePandocCodeStyles||g(m,v,"normal"!==a),d){const e=m.createElement("div"),r=m.createElement("code");r.innerText=d,e.innerHTML=`<h1>Pandoc Error:</h1>${r.outerHTML}<hr>`,m.body.insertBefore(e,m.body.firstElementChild)}return m});return function(r,t,o,n,i,a){return e.apply(this,arguments)}})(),t=(()=>{var e=n(function*(e){const r="relativized"===e.behaviour;switch(e.behaviour){case"relativized":case"absolutized":yield o(e.doc,e.filePath,{version:!1,relativize:r},e.savePath)}});return function(r){return e.apply(this,arguments)}})(),o=(()=>{var r=n(function*(r,t,o,a){var l=atom.project.relativizePath(t||"");const s=e(l,1)[0],c=d.getMedia(r);var m;yield Promise.all(Array.from(c).map((m=n(function*(e){let r=e.getAttribute("src");if(r){if("pandoc"!==f.atomConfig().renderer&&(r=decodeURI(r)),r.match(/^(https?|atom|data):/))return;if(process.resourcesPath&&r.startsWith(process.resourcesPath))return;if(r.startsWith(v))return;if(r.startsWith(h))return;if("/"===r[0]){if(!f.isFileSync(r))try{null!==s&&(r=i.join(s,r.substring(1)))}catch(e){}}else t&&(r=i.resolve(i.dirname(t),r));if(o.relativize&&(void 0!==t||void 0!==a)){const e=void 0!==a?a:t;r=i.relative(i.dirname(e),r)}if(o.version){const e=yield u.getVersion(r,t);e&&(r=`${r}?v=${e}`)}e.src=r}}),function(e){return m.apply(this,arguments)})))});return function(e,t,o,n){return r.apply(this,arguments)}})();function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function o(n,i){try{var a=r[n](i),l=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(l).then(function(e){o("next",e)},function(e){o("throw",e)});e(l)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const i=require("path"),a=require("atom-highlight"),l=require("./pandoc-helper"),s=require("./markdown-it-helper"),c=require("./extension-helper"),u=require("./image-watch-helper"),f=require("./util"),d=require("./util-common");var m=atom.getLoadSettings();const v=m.resourcePath,h=i.dirname(__dirname);function y(e){return new Error(`Invalid render mode ${e}`)}function p(e){e.querySelectorAll("script:not([type^='math/tex'])").forEach(e=>{e.remove()});const r=["onabort","onblur","onchange","onclick","ondbclick","onerror","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmousemove","onmouseover","onmouseout","onmouseup","onreset","onresize","onscroll","onselect","onsubmit","onunload"];e.querySelectorAll("*").forEach(e=>r.map(r=>{e.removeAttribute(r)}))}function g(e,r,t){const o=atom.config.get("editor.fontFamily");if(o){var n=!0,i=!1,l=void 0;try{for(var s,u=Array.from(e.querySelectorAll("code"))[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){s.value.style.fontFamily=o}}catch(e){i=!0,l=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw l}}}var f=!0,d=!1,m=void 0;try{for(var v,h=Array.from(e.querySelectorAll("pre"))[Symbol.iterator]();!(f=(v=h.next()).done);f=!0){const e=v.value,o=null!==e.firstElementChild?e.firstElementChild:e,n=o.className,i=n?n.replace(/^(lang-|sourceCode )/,""):r,l=t?"editor-colors ":"";e.outerHTML=a({fileContents:o.textContent.replace(/\n$/,""),scopeName:c.scopeForFenceName(i),nbsp:!1,lineDivs:!t,editorDiv:!0,editorDivTag:t?"pre":"atom-text-editor",editorDivClass:i?`${l}lang-${i}`:l})}}catch(e){d=!0,m=e}finally{try{!f&&h.return&&h.return()}finally{if(d)throw m}}return e}exports.render=r;
},{"./pandoc-helper":20,"./markdown-it-helper":21,"./extension-helper":22,"./image-watch-helper":23,"./util":11,"./util-common":6}],11:[function(require,module,exports) {
"use strict";let e=(()=>{var e=t(function*(e,n,i){const r=new u.WebviewHandler(t(function*(){r.init(atom.getConfigDirPath(),c().mathConfig.numberEquations),r.setUseGitHubStyle(atom.config.get("markdown-preview-plus.useGitHubStyle")),r.setBasePath(n);const t=yield l.render(e,n,void 0,i,"copy"),o=yield r.update(t.documentElement.outerHTML,i,"SVG");o&&atom.clipboard.write(o),r.destroy()}));r.element.style.pointerEvents="none",r.element.style.position="absolute",r.element.style.width="0px",r.element.style.height="0px",atom.views.getView(atom.workspace).appendChild(r.element)});return function(t,n,i){return e.apply(this,arguments)}})();function t(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function i(r,o){try{var s=t[r](o),a=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(a).then(function(e){i("next",e)},function(e){i("throw",e)});e(a)}("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});const n=require("tslib");function i(e){e&&e.catch(e=>{console.error(e),atom.notifications.addFatalError(e.toString(),{detail:e.message,stack:e.stack,dismissable:!0})})}exports.handlePromise=i;const r=require("fs");function o(e){return!!r.existsSync(e)&&r.lstatSync(e).isFile()}function s(e,t){return e.length%2!=0&&atom.notifications.addWarning(`Invalid math delimiter configuration${t?`in ${t}`:""}`,{detail:`Expected even number of elements, but got "${e.join(", ")}"`,dismissable:!0}),e.reduce(function(e,t,n,i){return n%2==0&&e.push([i[n],i[n+1]]),e},[])}function a(e){return e.nodeType===Node.ELEMENT_NODE}exports.isFileSync=o,exports.pairUp=s,exports.isElement=a;const u=require("./markdown-preview-view/webview-handler"),l=n.__importStar(require("./renderer"));function c(){return atom.config.get("markdown-preview-plus")}exports.copyHtml=e,exports.atomConfig=c;
},{"./markdown-preview-view/webview-handler":15,"./renderer":14}],4:[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};exports.__esModule=!0;var n,r=require("path"),o=require("season"),i=require("fs"),a=require("./util"),u=require("../src/util"),s=global.require.resolve("mathjax")+"?delayStartupUntil=configured",c="HTML-CSS";function l(n,r){return e(this,void 0,void 0,function(){return t(this,function(e){switch(e.label){case 0:return[4,h()];case 1:return e.sent(),[4,H(n,r)];case 2:return e.sent(),[2]}})})}function d(n){return e(this,void 0,void 0,function(){var e,r;return t(this,function(t){return e=document.getElementById("MathJax_SVG_Hidden"),null!==(r=e&&e.parentElement)?[2,r.innerHTML+n.innerHTML]:[2,n.innerHTML]})})}function h(){return e(this,void 0,void 0,function(){return t(this,function(e){return n?[2,n]:[2,n=g()]})})}function f(){n=void 0;var e=document.head.querySelector("script[src='"+s+"']");e&&e.remove()}function m(){return e(this,void 0,void 0,function(){var e,n,r;return t(this,function(t){switch(t.label){case 0:return[4,b()];case 1:return e=(e=t.sent())?w(e):{},[4,window.atomVars.numberEqns];case 2:return n=t.sent(),r={},[4,u.atomConfig().mathConfig.mjxExtensions];case 3:return[2,(r.extensions=t.sent(),r.Macros=e,r.equationNumbers=n?{autoNumber:"AMS",useLabelIds:!1}:{},r)]}})})}function p(){return e(this,void 0,void 0,function(){var e,n;return t(this,function(t){switch(t.label){case 0:return[4,window.atomVars.home];case 1:return e=t.sent(),[2,null!=(n=o.resolve(r.join(e,"markdown-preview-plus")))?n:r.join(e,"markdown-preview-plus.cson")]}})})}function v(e){return o.isObjectPath(e)?o.readFileSync(e,function(t,n){return void 0===n&&(n={}),void 0!==t&&(console.warn("Error reading Latex Macros file '"+e+"': "+(void 0!==t.stack?t.stack:t)),console.error("Failed to load Latex Macros from '"+e+"'",{detail:t.message,dismissable:!0})),n}):{}}function b(){return e(this,void 0,void 0,function(){var e;return t(this,function(t){switch(t.label){case 0:return[4,p()];case 1:return e=t.sent(),a.isFileSync(e)?[2,v(e)]:(console.debug("Creating markdown-preview-plus.cson, this is a one-time operation."),x(e),[2,v(e)])}})})}function x(e){var t=r.join(__dirname,"../assets/macros-template.cson"),n=i.readFileSync(t,"utf8");i.writeFileSync(e,n)}function w(e){var t=/^[^a-zA-Z\d\s]$|^[a-zA-Z]*$/;for(var n in e){var r=e[n];n.match(t)&&y(r)||(delete e[n],console.error("Failed to load LaTeX macro named '"+n+"'. Please see the [LaTeX guide](https://github.com/atom-community/markdown-preview-plus/blob/master/docs/math.md#macro-names)"))}return e}function y(e){if(Array.isArray(e)){var t=e[0],n=e[1];return"number"==typeof n&&(n%1==0&&"string"==typeof t)}return"string"==typeof e}function M(){return e(this,void 0,void 0,function(){var e,n,r,o,i;return t(this,function(t){switch(t.label){case 0:return n=(e=MathJax.Hub).Config,r={jax:["input/TeX","output/"+c],extensions:[]},[4,m()];case 1:return r.TeX=t.sent(),o="HTML-CSS",i={availableFonts:[],webFont:"TeX",imageFont:null,mtextFontInherit:!0},[4,u.atomConfig().mathConfig.mjxUndefinedFamily];case 2:return n.apply(e,[(r[o]=(i.undefinedFamily=t.sent(),i),r.messageStyle="none",r.showMathMenu=!1,r.skipStartupTypeset=!0,r)]),MathJax.Hub.Configured(),console.log("Loaded maths rendering engine MathJax"),[2]}})})}function g(){return e(this,void 0,void 0,function(){return t(this,function(e){switch(e.label){case 0:return console.log("Loading maths rendering engine MathJax"),[4,Promise.all([J(s)])];case 1:return e.sent(),[4,M()];case 2:return e.sent(),[2]}})})}function J(n){return e(this,void 0,void 0,function(){var e;return t(this,function(t){return(e=document.createElement("script")).src=n,e.type="text/javascript",document.head.appendChild(e),[2,new Promise(function(t){e.addEventListener("load",function(){return t()})})]})})}function H(n,r){return e(this,void 0,void 0,function(){var e;return t(this,function(t){switch(t.label){case 0:return Array.from(document.querySelectorAll('script[type^="math/tex"]')).some(function(e){return!e.id})?[4,window.atomVars.numberEqns]:[2];case 1:return e=t.sent(),[2,new Promise(function(t){MathJax.InputJax.TeX&&(MathJax.Hub.Queue(["resetEquationNumbers",MathJax.InputJax.TeX]),e&&(MathJax.Hub.Queue(["PreProcess",MathJax.Hub]),MathJax.Hub.Queue(["Reprocess",MathJax.Hub]))),MathJax.Hub.Queue(["setRenderer",MathJax.Hub,r]),MathJax.Hub.Queue(["Typeset",MathJax.Hub,n]),MathJax.Hub.Queue(["setRenderer",MathJax.Hub,c]),MathJax.Hub.Queue([t])})]}})})}exports.mathProcessor=l,exports.processHTMLString=d,exports.unloadMathJax=f,exports.jaxTeXConfig=m;
},{"./util":5,"../src/util":11}],3:[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function u(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};exports.__esModule=!0;var n=require("morphdom"),r=require("./mathjax-helper"),o=function(){function o(e){this.dom=e}return o.prototype.update=function(o,i,a){return e(this,void 0,void 0,function(){var e,u,c,l,s;return t(this,function(t){for(e=void 0===this.cachedMJRenderer?a:this.cachedMJRenderer,this.cachedMJRenderer=a,u=function(t){var n=t.firstElementChild;if(!n||"SCRIPT"!==n.nodeName)return"continue";t.isSameNode=function(t){if(e!==a)return!1;if("SPAN"!==t.nodeName)return!1;var r=t;if(!r.classList.contains("math"))return!1;var o=r.querySelector("script");return!!o&&n.innerHTML===o.innerHTML}},c=0,l=Array.from(o.querySelectorAll("span.math"));c<l.length;c++)s=l[c],u(s);return n(this.dom,o,{childrenOnly:!0,onElUpdated:function(e){"LI"===e.tagName&&(e.innerHTML=e.innerHTML)}}),i?[2,r.mathProcessor(this.dom,a)]:[2]})})},o}();exports.UpdatePreview=o;
},{"./mathjax-helper":4}],2:[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(a,u)}c((n=n.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var t,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},t=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r},n=this;exports.__esModule=!0;var o,i=require("electron"),a=require("./update-preview"),u=require("./mathjax-helper"),c=t(require("./util")),s=require("../src/util-common");function d(){var e,r=new Promise(function(r){return e=r});return r.resolve=e,r}window.atomVars={home:d(),numberEqns:d(),sourceLineMap:new Map,revSourceMap:new WeakMap},i.ipcRenderer.on("init",function(e,r){var t=r.atomHome,n=r.numberEqns;window.atomVars.home.resolve(t),window.atomVars.numberEqns.resolve(n)}),i.ipcRenderer.on("set-source-map",function(e,r){var t=r.map,n=document.querySelector("div.update-preview");if(!n)throw new Error("No root element!");for(var o=new Map,i=new WeakMap,a=0,u=Object.keys(t);a<u.length;a++){var s=u[a],d=parseInt(s,10),l=t[d],p=c.resolveElement(n,l);if(p){o.set(d,p);var f=i.get(p);f?f.push(d):i.set(p,[d])}}window.atomVars.sourceLineMap=o,window.atomVars.revSourceMap=i}),i.ipcRenderer.on("scroll-sync",function(e,r){var t,n,o=r.firstLine,i=r.lastLine,a=Math.floor(.5*(o+i)),u=window.atomVars.sourceLineMap;for(t=a;t>=0&&!(n=u.get(t));t-=1);if(n){var c,s,d=Math.max.apply(Math,Array.from(u.keys()));for(c=a+1;c<d&&!(s=u.get(c));c+=1);if(s){var l=n.getBoundingClientRect().top,p=s.getBoundingClientRect().top,f=(a-o)/(i-o),m=document.documentElement.scrollTop-document.documentElement.clientHeight/2+l+f*(p-l);window.scroll({top:m})}}}),i.ipcRenderer.on("style",function(e,r){var t=r.styles,n=document.head.querySelector("style#atom-styles");n||((n=document.createElement("style")).id="atom-styles",document.head.appendChild(n)),n.innerHTML=t.join("\n")}),i.ipcRenderer.on("update-images",function(e,r){for(var t=r.oldsrc,n=r.v,o=s.getMedia(document),i=0,a=Array.from(o);i<a.length;i++){var u=a[i],c=void 0,d=void 0,l=u.getAttribute("src"),p=l.match(/^(.*)\?v=(\d+)$/);p&&(l=p[1],c=p[2]),l===t&&(void 0!==c&&(d=parseInt(c,10)),n!==d&&(u.src=n?l+"?v="+n:""+l))}}),i.ipcRenderer.on("sync",function(e,r){var t=r.line;if(document.querySelector("div.update-preview")){var n=window.atomVars.sourceLineMap.get(t);if(!n)for(var o=t-1;o>=0&&!(n=window.atomVars.sourceLineMap.get(t));o-=1);n&&(n.scrollIntoViewIfNeeded(!0),n.classList.add("flash"),setTimeout(function(){return n.classList.remove("flash")},1e3))}}),i.ipcRenderer.on("use-github-style",function(e,r){var t=r.value,n=document.querySelector("markdown-preview-plus-view");if(!n)throw new Error("Can't find MPP-view");t?n.setAttribute("data-use-github-style",""):n.removeAttribute("data-use-github-style")}),i.ipcRenderer.on("update-preview",function(t,s){var d=s.id,l=s.html,p=s.renderLaTeX,f=s.mjrenderer,m=document.querySelector("div.update-preview");if(m){o||(o=new a.UpdatePreview(m));var v=(new DOMParser).parseFromString(l,"text/html");c.handlePromise(o.update(v.body,p,f).then(function(){return e(n,void 0,void 0,function(){var e,t,n,o;return r(this,function(r){switch(r.label){case 0:return t=(e=i.ipcRenderer).sendToHost,n=["request-reply"],o={id:d,request:"update-preview"},[4,u.processHTMLString(m)];case 1:return t.apply(e,n.concat([(o.result=r.sent(),o)])),[2]}})})}));var h=document;if(h&&v.head.hasChildNodes){var w=h.head.querySelector("original-elements");w||(w=h.createElement("original-elements"),h.head.appendChild(w)),w.innerHTML="";for(var y=0,g=Array.from(v.head.childNodes);y<g.length;y++){var b=g[y];w.appendChild(b)}}}});var l,p=document.createElement("base");document.head.appendChild(p),i.ipcRenderer.on("set-base-path",function(e,r){var t=r.path;p.href=t||""}),i.ipcRenderer.on("error",function(e,r){var t=r.msg,n=document.querySelector("div.update-preview");if(n){var o=document.createElement("div");o.innerHTML="<h2>Previewing Markdown Failed</h2><h3>"+t+"</h3>",n.appendChild(o)}}),document.addEventListener("mousewheel",function(e){e.ctrlKey&&(e.wheelDeltaY>0?i.ipcRenderer.sendToHost("zoom-in",void 0):e.wheelDeltaY<0&&i.ipcRenderer.sendToHost("zoom-out",void 0),e.preventDefault(),e.stopPropagation())}),document.addEventListener("scroll",function(e){var r=document.documentElement.clientHeight,t=Array.from(window.atomVars.sourceLineMap.entries()).filter(function(e){e[0];var t=e[1].getBoundingClientRect(),n=t.top,o=t.bottom;return n>0&&o<r}).map(function(e){var r=e[0];e[1];return r});i.ipcRenderer.sendToHost("did-scroll-preview",{max:Math.max.apply(Math,t),min:Math.min.apply(Math,t)})}),document.addEventListener("contextmenu",function(e){l=e.target}),i.ipcRenderer.on("sync-source",function(e,r){for(var t=r.id,n=l,o=window.atomVars.revSourceMap,a=o.get(n);!a&&n.parentElement;)n=n.parentElement,a=o.get(n);a&&i.ipcRenderer.sendToHost("request-reply",{id:t,request:"sync-source",result:Math.min.apply(Math,a)})}),i.ipcRenderer.on("reload",function(e,r){var t=r.id;window.onbeforeunload=null,i.ipcRenderer.sendToHost("request-reply",{id:t,request:"reload",result:void 0})}),window.onbeforeunload=function(){return!1},i.ipcRenderer.on("get-tex-config",function(t,o){var a=o.id;return e(n,void 0,void 0,function(){var e,t,n,o;return r(this,function(r){switch(r.label){case 0:return t=(e=i.ipcRenderer).sendToHost,n=["request-reply"],o={id:a,request:"get-tex-config"},[4,u.jaxTeXConfig()];case 1:return t.apply(e,n.concat([(o.result=r.sent(),o)])),[2]}})})});
},{"./update-preview":3,"./mathjax-helper":4,"./util":5,"../src/util-common":6}]},{},[2])
//# sourceMappingURL=main.0a6e71c8.map